<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="COMM">// Project:   SproutCore - JavaScript Application Framework</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="COMM">// Copyright: ©2006-2009 Sprout Systems, Inc. and contributors.</span><span class="WHIT">
<span class='line'>  4</span> </span><span class="COMM">//            Portions ©2008-2009 Apple Inc. All rights reserved.</span><span class="WHIT">
<span class='line'>  5</span> </span><span class="COMM">// License:   Licensed under MIT license (see license.js)</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  7</span> 
<span class='line'>  8</span> </span><span class="COMM">/** @namespace
<span class='line'>  9</span> 
<span class='line'> 10</span>   This mixin implements many of the basic state-handling attributes for 
<span class='line'> 11</span>   button-like views, including an auto-updated title, and mapping the current
<span class='line'> 12</span>   value to an isSelected state.
<span class='line'> 13</span>   
<span class='line'> 14</span>   Usually you will not work with this mixin directly.  Instead, you should use
<span class='line'> 15</span>   a class that incorporates the mixin such as SC.ButtonView, SC.CheckboxView
<span class='line'> 16</span>   or SC.RadioView.
<span class='line'> 17</span>   
<span class='line'> 18</span>   This mixin assumes you have already applied the SC.Control and 
<span class='line'> 19</span>   SC.DelegateSupport mixins as well.
<span class='line'> 20</span>   
<span class='line'> 21</span>   @since SproutCore 1.0  
<span class='line'> 22</span> */</span><span class="WHIT">
<span class='line'> 23</span> </span><span class="NAME">SC.Button</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 24</span>   
<span class='line'> 25</span>   </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'> 26</span>   </span><span class="COMM">// VALUE PROPERTIES</span><span class="WHIT">
<span class='line'> 27</span>   </span><span class="COMM">// </span><span class="WHIT">
<span class='line'> 28</span>   
<span class='line'> 29</span>   </span><span class="COMM">/**
<span class='line'> 30</span>     Used to automatically update the state of the button view for toggle style
<span class='line'> 31</span>     buttons.
<span class='line'> 32</span> 
<span class='line'> 33</span>     for toggle style buttons, you can set the value and it will be used to
<span class='line'> 34</span>     update the isSelected state of the button view.  The value will also
<span class='line'> 35</span>     change as the user selects or deselects.  You can control which values
<span class='line'> 36</span>     the button will treat as isSelected by setting the toggleOnValue and 
<span class='line'> 37</span>     toggleOffValue.  Alternatively, if you leave these properties set to
<span class='line'> 38</span>     YES or NO, the button will do its best to convert a value to an 
<span class='line'> 39</span>     appropriate state:
<span class='line'> 40</span>   
<span class='line'> 41</span>     - null, false, 0  -> isSelected = false
<span class='line'> 42</span>     - any other single value -> isSelected = true
<span class='line'> 43</span>     - array -> if all values are the same state: that state.  otherwise MIXED.
<span class='line'> 44</span>     
<span class='line'> 45</span>     @property {Object}
<span class='line'> 46</span>   */</span><span class="WHIT">  
<span class='line'> 47</span>   </span><span class="NAME">value</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 48</span>   
<span class='line'> 49</span>   </span><span class="COMM">/**
<span class='line'> 50</span>     Value of a selected toggle button.
<span class='line'> 51</span>   
<span class='line'> 52</span>     for a toggle button, set this to any object value you want.  The button
<span class='line'> 53</span>     will be selected if the value property equals the targetValue.  If the
<span class='line'> 54</span>     value is an array of multiple items that contains the targetValue, then
<span class='line'> 55</span>     the button will be set to a mixed state.
<span class='line'> 56</span> 
<span class='line'> 57</span>     default is YES
<span class='line'> 58</span>     
<span class='line'> 59</span>     @property {Object}
<span class='line'> 60</span>   */</span><span class="WHIT">
<span class='line'> 61</span>   </span><span class="NAME">toggleOnValue</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 62</span> 
<span class='line'> 63</span>   </span><span class="COMM">/**
<span class='line'> 64</span>     Value of an unselected toggle button.
<span class='line'> 65</span>   
<span class='line'> 66</span>     For a toggle button, set this to any object value you want.  When the
<span class='line'> 67</span>     user toggle's the button off, the value of the button will be set to this
<span class='line'> 68</span>     value.
<span class='line'> 69</span>   
<span class='line'> 70</span>     default is NO 
<span class='line'> 71</span>   
<span class='line'> 72</span>     @property {Object}
<span class='line'> 73</span>   */</span><span class="WHIT">
<span class='line'> 74</span>   </span><span class="NAME">toggleOffValue</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 75</span>   
<span class='line'> 76</span>   </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'> 77</span>   </span><span class="COMM">// TITLE </span><span class="WHIT">
<span class='line'> 78</span>   </span><span class="COMM">// </span><span class="WHIT">
<span class='line'> 79</span>   
<span class='line'> 80</span>   </span><span class="COMM">/**
<span class='line'> 81</span>     If YES, then the title will be localized.
<span class='line'> 82</span>     
<span class='line'> 83</span>     @property {Boolean}
<span class='line'> 84</span>   */</span><span class="WHIT">
<span class='line'> 85</span>   </span><span class="NAME">localize</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 86</span>   
<span class='line'> 87</span>   </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'> 88</span>   </span><span class="NAME">localizeBindingDefault</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.Binding.bool</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 89</span> 
<span class='line'> 90</span>   </span><span class="COMM">/**
<span class='line'> 91</span>     The button title.  If localize is YES, then this should be the localization key to display.  Otherwise, this will be the actual string displayed in the title.  This property is observable and bindable.
<span class='line'> 92</span>     
<span class='line'> 93</span>     @property {String}
<span class='line'> 94</span>   */</span><span class="WHIT">  
<span class='line'> 95</span>   </span><span class="NAME">title</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 96</span> 
<span class='line'> 97</span>   </span><span class="COMM">/**
<span class='line'> 98</span>     If you set this property, the title property will be updated automatically
<span class='line'> 99</span>     from the content using the key you specify.
<span class='line'>100</span>     
<span class='line'>101</span>     @property {String}
<span class='line'>102</span>   */</span><span class="WHIT">
<span class='line'>103</span>   </span><span class="NAME">contentTitleKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>104</span>   
<span class='line'>105</span>   </span><span class="COMM">/**
<span class='line'>106</span>     The button icon.  Set this to either a URL or a CSS class name (for 
<span class='line'>107</span>     spriting).  Note that if you pass a URL, it must contain at 
<span class='line'>108</span>     least one slash to be detected as such.
<span class='line'>109</span>     
<span class='line'>110</span>     @property {String}
<span class='line'>111</span>   */</span><span class="WHIT">
<span class='line'>112</span>   </span><span class="NAME">icon</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>113</span> 
<span class='line'>114</span>   </span><span class="COMM">/**
<span class='line'>115</span>     If you set this property, the icon will be updated automatically from the
<span class='line'>116</span>     content using the key you specify.
<span class='line'>117</span>     
<span class='line'>118</span>     @property {String}
<span class='line'>119</span>   */</span><span class="WHIT">
<span class='line'>120</span>   </span><span class="NAME">contentIconKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>121</span> 
<span class='line'>122</span>   </span><span class="COMM">/**
<span class='line'>123</span>     If YES, button will attempt to display an ellipsis if the title cannot 
<span class='line'>124</span>     fit inside of the visible area.  This feature is not available on all
<span class='line'>125</span>     browsers.
<span class='line'>126</span>     
<span class='line'>127</span>     @property {Boolean}
<span class='line'>128</span>   */</span><span class="WHIT">
<span class='line'>129</span>   </span><span class="NAME">needsEllipsis</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>130</span>   
<span class='line'>131</span>   </span><span class="COMM">/**
<span class='line'>132</span>     The computed display title.  This is generated by localizing the title 
<span class='line'>133</span>     property if necessary.
<span class='line'>134</span>     
<span class='line'>135</span>     @property {String}
<span class='line'>136</span>   */</span><span class="WHIT">
<span class='line'>137</span>   </span><span class="NAME">displayTitle</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>138</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'title'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>139</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'localize'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">ret.loc</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>140</span>   </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'title'</span><span class="PUNC">,</span><span class="STRN">'localize'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>141</span>   
<span class='line'>142</span>   </span><span class="COMM">/**
<span class='line'>143</span>     The key equivalent that should trigger this button on the page.
<span class='line'>144</span>     
<span class='line'>145</span>     @property {String}
<span class='line'>146</span>   */</span><span class="WHIT">
<span class='line'>147</span>   </span><span class="NAME">keyEquivalent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>148</span>   
<span class='line'>149</span>   </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>150</span>   </span><span class="COMM">// METHODS</span><span class="WHIT">
<span class='line'>151</span>   </span><span class="COMM">// </span><span class="WHIT">
<span class='line'>152</span>   
<span class='line'>153</span>   </span><span class="COMM">/**
<span class='line'>154</span>     Classes that include this mixin can invoke this method from their 
<span class='line'>155</span>     render method to render the proper title HTML.  This will include an 
<span class='line'>156</span>     icon if necessary along with any other standard markup.
<span class='line'>157</span>     
<span class='line'>158</span>     @param {SC.RenderContext} context the context to render
<span class='line'>159</span>     @param {Boolean} firstTime YES if first time rendering
<span class='line'>160</span>     @returns {SC.RenderContext} the context
<span class='line'>161</span>   */</span><span class="WHIT">
<span class='line'>162</span>   </span><span class="NAME">renderTitle</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">firstTime</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>163</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">icon</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'icon'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>164</span>         </span><span class="NAME">image</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>165</span>         </span><span class="NAME">title</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'displayTitle'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>166</span>         </span><span class="NAME">needsTitle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">title</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">title.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>167</span>         </span><span class="NAME">elem</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">htmlNode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">imgTitle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>168</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'escapeHTML'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">title</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.RenderContext.escapeHTML</span><span class="PUNC">(</span><span class="NAME">title</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>169</span>         
<span class='line'>170</span>     </span><span class="COMM">// get the icon.  If there is an icon, then get the image and update it.</span><span class="WHIT">
<span class='line'>171</span>     </span><span class="COMM">// if there is no image element yet, create it and insert it just before</span><span class="WHIT">
<span class='line'>172</span>     </span><span class="COMM">// title.</span><span class="WHIT">
<span class='line'>173</span>     
<span class='line'>174</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">icon</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>175</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.BLANK_IMAGE_URL</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>176</span> 
<span class='line'>177</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">icon.indexOf</span><span class="PUNC">(</span><span class="STRN">'/'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>178</span>         </span><span class="NAME">image</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'&lt;img src="'</span><span class="PUNC">+</span><span class="NAME">icon</span><span class="PUNC">+</span><span class="STRN">'" alt="" class="icon" />'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>179</span>       </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>180</span>         </span><span class="NAME">image</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'&lt;img src="'</span><span class="PUNC">+</span><span class="NAME">blank</span><span class="PUNC">+</span><span class="STRN">'" alt="" class="'</span><span class="PUNC">+</span><span class="NAME">icon</span><span class="PUNC">+</span><span class="STRN">'" />'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>181</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>182</span>       </span><span class="NAME">needsTitle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>183</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>184</span>     </span><span class="NAME">imgTitle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">image</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">title</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>185</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">firstTime</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>186</span>       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'needsEllipsis'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>187</span>         </span><span class="NAME">context.push</span><span class="PUNC">(</span><span class="STRN">'&lt;label class="sc-button-label ellipsis">'</span><span class="PUNC">+</span><span class="NAME">imgTitle</span><span class="PUNC">+</span><span class="STRN">'&lt;/label>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>188</span>       </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>189</span>           </span><span class="NAME">context.push</span><span class="PUNC">(</span><span class="STRN">'&lt;label class="sc-button-label">'</span><span class="PUNC">+</span><span class="NAME">imgTitle</span><span class="PUNC">+</span><span class="STRN">'&lt;/label>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>190</span>       </span><span class="PUNC">}</span><span class="WHIT">  
<span class='line'>191</span>       </span><span class="NAME">this._ImageTitleCached</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">imgTitle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>192</span>     </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>193</span>       </span><span class="NAME">elem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.$</span><span class="PUNC">(</span><span class="STRN">'label'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  
<span class='line'>194</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">htmlNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elem</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>195</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">needsTitle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>196</span>           </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'needsEllipsis'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>197</span>             </span><span class="NAME">elem.addClass</span><span class="PUNC">(</span><span class="STRN">'ellipsis'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>198</span>             </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._ImageTitleCached</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">imgTitle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>199</span>               </span><span class="NAME">this._ImageTitleCached</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">imgTitle</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Update the cache</span><span class="WHIT">
<span class='line'>200</span>               </span><span class="NAME">htmlNode.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">imgTitle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>201</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>202</span>           </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>203</span>             </span><span class="NAME">elem.removeClass</span><span class="PUNC">(</span><span class="STRN">'ellipsis'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>204</span>             </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._ImageTitleCached</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">imgTitle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>205</span>               </span><span class="NAME">this._ImageTitleCached</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">imgTitle</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Update the cache</span><span class="WHIT">
<span class='line'>206</span>               </span><span class="NAME">htmlNode.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">imgTitle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>207</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>208</span>           </span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'>209</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>210</span>         </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">htmlNode.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'>211</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>212</span>     </span><span class="PUNC">}</span><span class="WHIT">  
<span class='line'>213</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">context</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>214</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>215</span> 
<span class='line'>216</span>   </span><span class="COMM">/**
<span class='line'>217</span>     Updates the value, title, and icon keys based on the content object, if 
<span class='line'>218</span>     set.
<span class='line'>219</span>     
<span class='line'>220</span>     @property {Object} target the target of the object that changed
<span class='line'>221</span>     @property {String} key name of property that changed
<span class='line'>222</span>     @returns {SC.Button} receiver
<span class='line'>223</span>   */</span><span class="WHIT">
<span class='line'>224</span>   </span><span class="NAME">contentPropertyDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>225</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'displayDelegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>226</span>         </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>227</span> 
<span class='line'>228</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'contentValueKey'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>229</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">valueKey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">valueKey</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'*'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>230</span>       </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">valueKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>231</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>232</span> 
<span class='line'>233</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">titleKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'contentTitleKey'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>234</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">titleKey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">titleKey</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'*'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>235</span>       </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'title'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">titleKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>236</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>237</span> 
<span class='line'>238</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iconKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'contentIconKey'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>239</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">iconKey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">iconKey</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'*'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>240</span>       </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'icon'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">iconKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>241</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>242</span>     
<span class='line'>243</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>244</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>245</span> 
<span class='line'>246</span>   </span><span class="COMM">/** @private - when title changes, dirty display. */</span><span class="WHIT">
<span class='line'>247</span>   </span><span class="NAME">_button_displayObserver</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>248</span>     </span><span class="NAME">this.displayDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>249</span>   </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">observes</span><span class="PUNC">(</span><span class="STRN">'title'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'icon'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'value'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>250</span> 
<span class='line'>251</span>   </span><span class="COMM">/**
<span class='line'>252</span>     Handle a key equivalent if set.  Trigger the default action for the 
<span class='line'>253</span>     button.  Depending on the implementation this may vary.
<span class='line'>254</span>     
<span class='line'>255</span>     @param {String} keystring
<span class='line'>256</span>     @param {SC.Event} evt
<span class='line'>257</span>     @returns {Boolean}  YES if handled, NO otherwise
<span class='line'>258</span>   */</span><span class="WHIT">
<span class='line'>259</span>   </span><span class="NAME">performKeyEquivalent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">keystring</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>260</span> 
<span class='line'>261</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEnabled'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>262</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">equiv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'keyEquivalent'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>263</span> 
<span class='line'>264</span>     </span><span class="COMM">// button has defined a keyEquivalent and it matches!</span><span class="WHIT">
<span class='line'>265</span>     </span><span class="COMM">// if triggering succeeded, true will be returned and the operation will </span><span class="WHIT">
<span class='line'>266</span>     </span><span class="COMM">// be handeled (i.e performKeyEquivalent will cease crawling the view </span><span class="WHIT">
<span class='line'>267</span>     </span><span class="COMM">// tree)</span><span class="WHIT">
<span class='line'>268</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">equiv</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>269</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">equiv</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">keystring</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.triggerAction</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>270</span>     
<span class='line'>271</span>     </span><span class="COMM">// should fire if isDefault OR isCancel.  This way if isDefault AND </span><span class="WHIT">
<span class='line'>272</span>     </span><span class="COMM">// isCancel, responds to both return and escape</span><span class="WHIT">
<span class='line'>273</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isDefault'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">keystring</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'return'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>274</span>         </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isCancel'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">keystring</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'escape'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>275</span>           </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.triggerAction</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>276</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>277</span> 
<span class='line'>278</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// did not handle it; keep searching</span><span class="WHIT">
<span class='line'>279</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>280</span> 
<span class='line'>281</span>   </span><span class="COMM">/**
<span class='line'>282</span>     Your class should implement this method to perform the default action on
<span class='line'>283</span>     the button.  This is used to implement keyboard control.  Your button
<span class='line'>284</span>     may make this change in its own way also.
<span class='line'>285</span>     
<span class='line'>286</span>     @property {SC.Event} evt the event
<span class='line'>287</span>     @returns {void}
<span class='line'>288</span>   */</span><span class="WHIT">
<span class='line'>289</span>   </span><span class="NAME">triggerAction</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>290</span>     </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"SC.Button.triggerAction() is not defined in %@"</span><span class="PUNC">.</span><span class="NAME">fmt</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>291</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>292</span> 
<span class='line'>293</span>   </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>294</span>   </span><span class="COMM">// VALUE &lt;-> isSelected STATE MANAGEMNT</span><span class="WHIT">
<span class='line'>295</span>   </span><span class="COMM">// </span><span class="WHIT">
<span class='line'>296</span> 
<span class='line'>297</span>   </span><span class="COMM">/**
<span class='line'>298</span>     This is the standard logic to compute a proposed isSelected state for a
<span class='line'>299</span>     new value.  This takes into account the toggleOnValue/toggleOffValue 
<span class='line'>300</span>     properties, among other things.  It may return YES, NO, or SC.MIXED_STATE.
<span class='line'>301</span>     
<span class='line'>302</span>     @param {Object} value
<span class='line'>303</span>     @returns {Boolean} return state
<span class='line'>304</span>   */</span><span class="WHIT">
<span class='line'>305</span>   </span><span class="NAME">computeIsSelectedForValue</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>306</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'toggleOnValue'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">next</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>307</span>     
<span class='line'>308</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.T_ARRAY</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>309</span> 
<span class='line'>310</span>       </span><span class="COMM">// treat a single item array like a single value</span><span class="WHIT">
<span class='line'>311</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>312</span>         </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>313</span>         
<span class='line'>314</span>       </span><span class="COMM">// for a multiple item array, check the states of all items.</span><span class="WHIT">
<span class='line'>315</span>       </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>316</span>         </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>317</span>         </span><span class="NAME">value.find</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>318</span>           </span><span class="NAME">next</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>319</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>320</span>             </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">next</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>321</span>           </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">next</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.MIXED_STATE</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>322</span>           </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.MIXED_STATE</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// stop when we hit a mixed state.</span><span class="WHIT">
<span class='line'>323</span>         </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>324</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>325</span>       
<span class='line'>326</span>     </span><span class="COMM">// for single values, just compare to the toggleOnValue...use truthiness</span><span class="WHIT">
<span class='line'>327</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>328</span>       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.MIXED_STATE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.MIXED_STATE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>329</span>       </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">targetValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>330</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>331</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>332</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>333</span>   
<span class='line'>334</span>   </span><span class="COMM">/** @ignore */</span><span class="WHIT">
<span class='line'>335</span>   </span><span class="NAME">initMixin</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>336</span>     </span><span class="COMM">// if value is not null, update isSelected to match value.  If value is</span><span class="WHIT">
<span class='line'>337</span>     </span><span class="COMM">// null, we assume you may be using isSelected only.  </span><span class="WHIT">
<span class='line'>338</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._button_valueDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  
<span class='line'>339</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>340</span>   
<span class='line'>341</span>   </span><span class="COMM">/** @private
<span class='line'>342</span>     Whenever the button value changes, update the selected state to match.
<span class='line'>343</span>   */</span><span class="WHIT">
<span class='line'>344</span>   </span><span class="NAME">_button_valueDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>345</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>346</span>         </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.computeIsSelectedForValue</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>347</span>     </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'isSelected'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// set new state...</span><span class="WHIT">
<span class='line'>348</span>   </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">observes</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>349</span>   
<span class='line'>350</span>   </span><span class="COMM">/** @private
<span class='line'>351</span>     Whenever the selected state is changed, make sure the button value is also updated.  Note that this may be called because the value has just changed.  In that case this should do nothing.
<span class='line'>352</span>   */</span><span class="WHIT">
<span class='line'>353</span>   </span><span class="NAME">_button_isSelectedDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>354</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isSelected'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>355</span>         </span><span class="NAME">curState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.computeIsSelectedForValue</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>356</span>     
<span class='line'>357</span>     </span><span class="COMM">// fix up the value, but only if computed state does not match.</span><span class="WHIT">
<span class='line'>358</span>     </span><span class="COMM">// never fix up value if isSelected is set to MIXED_STATE since this can</span><span class="WHIT">
<span class='line'>359</span>     </span><span class="COMM">// only come from the value.</span><span class="WHIT">
<span class='line'>360</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">newState</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">SC.MIXED_STATE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">curState</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">newState</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>361</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">newState</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'toggleOnValue'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'toggleOffValue'</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>362</span>       </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="NAME">valueKey</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>363</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>364</span>   </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">observes</span><span class="PUNC">(</span><span class="STRN">'isSelected'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>365</span>   
<span class='line'>366</span> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>367</span> </span></pre></body></html>