<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="COMM">// Project:   SproutCore - JavaScript Application Framework</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="COMM">// Copyright: ©2006-2009 Sprout Systems, Inc. and contributors.</span><span class="WHIT">
<span class='line'>  4</span> </span><span class="COMM">//            Portions ©2008-2009 Apple Inc. All rights reserved.</span><span class="WHIT">
<span class='line'>  5</span> </span><span class="COMM">// License:   Licensed under MIT license (see license.js)</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  7</span> 
<span class='line'>  8</span> </span><span class="NAME">sc_require</span><span class="PUNC">(</span><span class="STRN">'validators/validator'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  9</span> 
<span class='line'> 10</span> </span><span class="COMM">/** @class
<span class='line'> 11</span>   Validate a field value as a credit card number. 
<span class='line'> 12</span>   
<span class='line'> 13</span>   This validator will perform a basic check to ensure the credit card number
<span class='line'> 14</span>   is mathematically valid.  It will also accept numbers with spaces, dashes
<span class='line'> 15</span>   or other punctuation.  
<span class='line'> 16</span>   
<span class='line'> 17</span>   Converted credit card numbers are broken into units of 4.
<span class='line'> 18</span>   
<span class='line'> 19</span>   Basic credit card validation courtesy David Leppek 
<span class='line'> 20</span>   (https://www.azcode.com/Mod10)
<span class='line'> 21</span> 
<span class='line'> 22</span>   @extends SC.Validator
<span class='line'> 23</span>   @since SproutCore 1.0
<span class='line'> 24</span> */</span><span class="WHIT">
<span class='line'> 25</span> </span><span class="NAME">SC.Validator.CreditCard</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.Validator.extend</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'> 26</span> </span><span class="COMM">/** @scope SC.Validator.CreditCard.prototype */</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 27</span> 
<span class='line'> 28</span>   </span><span class="COMM">/**
<span class='line'> 29</span>     Expects a string of 16 digits.  Will split into groups of 4 for display.
<span class='line'> 30</span>   */</span><span class="WHIT">
<span class='line'> 31</span>   </span><span class="NAME">fieldValueForObject</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 32</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">object.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 33</span>       </span><span class="NAME">object</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">object.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">object.slice</span><span class="PUNC">(</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NUMB">8</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">object.slice</span><span class="PUNC">(</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="NUMB">12</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">object.slice</span><span class="PUNC">(</span><span class="NUMB">12</span><span class="PUNC">,</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 34</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 35</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">object</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 36</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 37</span> 
<span class='line'> 38</span>   </span><span class="COMM">/**
<span class='line'> 39</span>     Removes all whitespace or dashes to make a single string.
<span class='line'> 40</span>   */</span><span class="WHIT">
<span class='line'> 41</span>   </span><span class="NAME">objectForFieldValue</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 42</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">value.replace</span><span class="PUNC">(</span><span class="REGX">/[\s-\.\:]/g</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 43</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 44</span>   
<span class='line'> 45</span>   </span><span class="NAME">validate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'> 46</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.checkNumber</span><span class="PUNC">(</span><span class="NAME">field.get</span><span class="PUNC">(</span><span class="STRN">'fieldValue'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'> 47</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 48</span>   
<span class='line'> 49</span>   </span><span class="NAME">validateError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 50</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">label</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">field.get</span><span class="PUNC">(</span><span class="STRN">'errorLabel'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'Field'</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 51</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">SC.$error</span><span class="PUNC">(</span><span class="STRN">"Invalid.CreditCard(%@)"</span><span class="PUNC">.</span><span class="NAME">loc</span><span class="PUNC">(</span><span class="NAME">label</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">label</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 52</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 53</span>   
<span class='line'> 54</span>   </span><span class="COMM">/** 
<span class='line'> 55</span>     Allow only numbers, dashes, and spaces 
<span class='line'> 56</span>   */</span><span class="WHIT">
<span class='line'> 57</span>   </span><span class="NAME">validateKeyDown</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">charStr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 58</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">charStr.match</span><span class="PUNC">(</span><span class="REGX">/[0-9\- ]/</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 59</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 60</span>   
<span class='line'> 61</span>   </span><span class="NAME">checkNumber</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ccNumb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 62</span>     
<span class='line'> 63</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ccNumb</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ccNumb.length</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// do not validate empty</span><span class="WHIT">
<span class='line'> 64</span>     
<span class='line'> 65</span>     </span><span class="COMM">// remove any spaces or dashes</span><span class="WHIT">
<span class='line'> 66</span>     </span><span class="NAME">ccNumb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ccNumb.replace</span><span class="PUNC">(</span><span class="REGX">/[^0-9]/g</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 67</span>     
<span class='line'> 68</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"0123456789"</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// Valid digits in a credit card number</span><span class="WHIT">
<span class='line'> 69</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ccNumb.length</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// The length of the submitted cc number</span><span class="WHIT">
<span class='line'> 70</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iCCN</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">ccNumb</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// integer of ccNumb</span><span class="WHIT">
<span class='line'> 71</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sCCN</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ccNumb.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// string of ccNumb</span><span class="WHIT">
<span class='line'> 72</span>     </span><span class="NAME">sCCN</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sCCN.replace</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="REGX">/^\s+|\s+$/g</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// strip spaces</span><span class="WHIT">
<span class='line'> 73</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iTotal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// integer total set at zero</span><span class="WHIT">
<span class='line'> 74</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bNum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// by default assume it is a number</span><span class="WHIT">
<span class='line'> 75</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// by default assume it is NOT a valid cc</span><span class="WHIT">
<span class='line'> 76</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">temp</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// temp variable for parsing string</span><span class="WHIT">
<span class='line'> 77</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">calc</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// used for calculation of each digit</span><span class="WHIT">
<span class='line'> 78</span> 
<span class='line'> 79</span>     </span><span class="COMM">// Determine if the ccNumb is in fact all numbers</span><span class="WHIT">
<span class='line'> 80</span>     </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 81</span>       </span><span class="NAME">temp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sCCN.substring</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 82</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">valid.indexOf</span><span class="PUNC">(</span><span class="NAME">temp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"-1"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">bNum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 83</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 84</span> 
<span class='line'> 85</span>     </span><span class="COMM">// if it is NOT a number, you can either alert to the fact, </span><span class="WHIT">
<span class='line'> 86</span>     </span><span class="COMM">// or just pass a failure</span><span class="WHIT">
<span class='line'> 87</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">bNum</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">bResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 88</span> 
<span class='line'> 89</span>     </span><span class="COMM">// Determine if it is the proper length </span><span class="WHIT">
<span class='line'> 90</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">bResult</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">  </span><span class="COMM">// nothing, field is blank AND passed above # check</span><span class="WHIT">
<span class='line'> 91</span>       </span><span class="NAME">bResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 92</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">  </span><span class="COMM">// ccNumb is a number and the proper length - let's see if it is a valid card number</span><span class="WHIT">
<span class='line'> 93</span>       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">  </span><span class="COMM">// 15 or 16 for Amex or V/MC</span><span class="WHIT">
<span class='line'> 94</span>         </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">  </span><span class="COMM">// LOOP throught the digits of the card</span><span class="WHIT">
<span class='line'> 95</span>           </span><span class="NAME">calc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">iCCN</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// right most digit</span><span class="WHIT">
<span class='line'> 96</span>           </span><span class="NAME">calc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">calc</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// assure it is an integer</span><span class="WHIT">
<span class='line'> 97</span>           </span><span class="NAME">iTotal</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calc</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// running total of the card number as we loop - Do Nothing to first digit</span><span class="WHIT">
<span class='line'> 98</span>           </span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// decrement the count - move to the next digit in the card</span><span class="WHIT">
<span class='line'> 99</span>           </span><span class="NAME">iCCN</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">iCCN</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">                               </span><span class="COMM">// subtracts right most digit from ccNumb</span><span class="WHIT">
<span class='line'>100</span>           </span><span class="NAME">calc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">iCCN</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">    </span><span class="COMM">// NEXT right most digit</span><span class="WHIT">
<span class='line'>101</span>           </span><span class="NAME">calc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calc</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">                                 </span><span class="COMM">// multiply the digit by two</span><span class="WHIT">
<span class='line'>102</span>           </span><span class="COMM">// Instead of some screwy method of converting 16 to a string and then parsing 1 and 6 and then adding them to make 7,</span><span class="WHIT">
<span class='line'>103</span>           </span><span class="COMM">// I use a simple switch statement to change the value of calc2 to 7 if 16 is the multiple.</span><span class="WHIT">
<span class='line'>104</span>           </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">calc</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>105</span>             </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">calc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">       </span><span class="COMM">//5*2=10 & 1+0 = 1</span><span class="WHIT">
<span class='line'>106</span>             </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">calc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">       </span><span class="COMM">//6*2=12 & 1+2 = 3</span><span class="WHIT">
<span class='line'>107</span>             </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">14</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">calc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">       </span><span class="COMM">//7*2=14 & 1+4 = 5</span><span class="WHIT">
<span class='line'>108</span>             </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">calc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">       </span><span class="COMM">//8*2=16 & 1+6 = 7</span><span class="WHIT">
<span class='line'>109</span>             </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">18</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">calc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">       </span><span class="COMM">//9*2=18 & 1+8 = 9</span><span class="WHIT">
<span class='line'>110</span>             </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">calc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calc</span><span class="PUNC">;</span><span class="WHIT">           </span><span class="COMM">//4*2= 8 &   8 = 8  -same for all lower numbers</span><span class="WHIT">
<span class='line'>111</span>           </span><span class="PUNC">}</span><span class="WHIT">                                               
<span class='line'>112</span>         </span><span class="NAME">iCCN</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">iCCN</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// subtracts right most digit from ccNum</span><span class="WHIT">
<span class='line'>113</span>         </span><span class="NAME">iTotal</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calc</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// running total of the card number as we loop</span><span class="WHIT">
<span class='line'>114</span>       </span><span class="PUNC">}</span><span class="WHIT">  </span><span class="COMM">// END OF LOOP</span><span class="WHIT">
<span class='line'>115</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">iTotal</span><span class="PUNC">%</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">  </span><span class="COMM">// check to see if the sum Mod 10 is zero</span><span class="WHIT">
<span class='line'>116</span>         </span><span class="NAME">bResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// This IS (or could be) a valid credit card number.</span><span class="WHIT">
<span class='line'>117</span>       </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>118</span>         </span><span class="NAME">bResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// This could NOT be a valid credit card number</span><span class="WHIT">
<span class='line'>119</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>120</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>121</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>122</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">bResult</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Return the results</span><span class="WHIT">
<span class='line'>123</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>124</span>     
<span class='line'>125</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>126</span> </span></pre></body></html>