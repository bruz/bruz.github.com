<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="COMM">// Project:   SproutCore - JavaScript Application Framework</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="COMM">// Copyright: ©2006-2009 Sprout Systems, Inc. and contributors.</span><span class="WHIT">
<span class='line'>  4</span> </span><span class="COMM">//            Portions ©2008-2009 Apple Inc. All rights reserved.</span><span class="WHIT">
<span class='line'>  5</span> </span><span class="COMM">// License:   Licensed under MIT license (see license.js)</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  7</span> 
<span class='line'>  8</span> </span><span class="NAME">SC.VALIDATE_OK</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  9</span> </span><span class="NAME">SC.VALIDATE_NO_CHANGE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 10</span> 
<span class='line'> 11</span> </span><span class="COMM">/**
<span class='line'> 12</span>   @class
<span class='line'> 13</span>   
<span class='line'> 14</span>   Validators provide a way for you to implement simple form field validation
<span class='line'> 15</span>   and transformation.  To use a validator, simply name the validator in the
<span class='line'> 16</span>   "validate" attribute in your text field.  For example, if you want to
<span class='line'> 17</span>   validate a field using the PhoneNumberValidator use this:
<span class='line'> 18</span> 
<span class='line'> 19</span>   &lt;input value="1234567890" validate="phone-number" />
<span class='line'> 20</span> 
<span class='line'> 21</span>   Validators get notified at three points.  You can implement one or all
<span class='line'> 22</span>   of these methods to support validation.  All of the validate methods except
<span class='line'> 23</span>   for validateKeypress behave the same way.  You are passed a form, field,
<span class='line'> 24</span>   and possibly the oldValue.  You are expected to return Validator.OK or
<span class='line'> 25</span>   an error string.  Inside this method you typically do one of all of the
<span class='line'> 26</span>   following:
<span class='line'> 27</span> 
<span class='line'> 28</span>   1. You can simply validate the field value and return OK or an error str
<span class='line'> 29</span>   
<span class='line'> 30</span>   2. You can modify the field value (for example, you could format the
<span class='line'> 31</span>      string to match some predefined format).
<span class='line'> 32</span>      
<span class='line'> 33</span>   3. If you need to roundtrip the server first to perform validation, you can
<span class='line'> 34</span>      return Validator.OK, then save the form and field info until after the
<span class='line'> 35</span>      roundtrip.  On return, if there is a problem, first verify the field
<span class='line'> 36</span>      value has not changed and then call form.errorFor(field,str) ;
<span class='line'> 37</span> 
<span class='line'> 38</span>   @extends SC.Object
<span class='line'> 39</span>   @since SproutCore 1.0
<span class='line'> 40</span> */</span><span class="WHIT">
<span class='line'> 41</span> </span><span class="NAME">SC.Validator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.Object.extend</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="COMM">/** @scope SC.Validator.prototype */</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 43</span> 
<span class='line'> 44</span>   </span><span class="COMM">// ..........................................</span><span class="WHIT">
<span class='line'> 45</span>   </span><span class="COMM">// OBJECT VALUE CONVERSION</span><span class="WHIT">
<span class='line'> 46</span>   </span><span class="COMM">//</span><span class="WHIT">
<span class='line'> 47</span>   </span><span class="COMM">// The following methods are used to convert the string value of a field</span><span class="WHIT">
<span class='line'> 48</span>   </span><span class="COMM">// to and from an object value.  The default implementations return</span><span class="WHIT">
<span class='line'> 49</span>   </span><span class="COMM">// the string, but you can override this to provide specific behaviors. </span><span class="WHIT">
<span class='line'> 50</span>   </span><span class="COMM">// For example, you might add or remove a dollar sign or convert the </span><span class="WHIT">
<span class='line'> 51</span>   </span><span class="COMM">// value to a number.</span><span class="WHIT">
<span class='line'> 52</span>   
<span class='line'> 53</span> </span><span class="COMM">/**
<span class='line'> 54</span>   Returns the value to set in the field for the passed object value.  
<span class='line'> 55</span>   
<span class='line'> 56</span>   The form and view to be set MAY (but will not always) be passed also.  You
<span class='line'> 57</span>   should override this method to help convert an input object into a value
<span class='line'> 58</span>   that can be displayed by the field.  For example, you might convert a 
<span class='line'> 59</span>   date to a property formatted string or a number to a properly formatted
<span class='line'> 60</span>   value.
<span class='line'> 61</span>   
<span class='line'> 62</span>   @param {Object} object The object to transform
<span class='line'> 63</span>   @param {SC.FormView} form The form this field belongs to. (optional)
<span class='line'> 64</span>   @param {SC.View} view The view the value is required for.
<span class='line'> 65</span>   @returns {Object} a value (usually a string) suitable for display
<span class='line'> 66</span> */</span><span class="WHIT">
<span class='line'> 67</span>   </span><span class="NAME">fieldValueForObject</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">view</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">object</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 68</span>   
<span class='line'> 69</span>   </span><span class="COMM">/**
<span class='line'> 70</span>     Returns the object value for the passed string.
<span class='line'> 71</span>     
<span class='line'> 72</span>     The form and view MAY (but wil not always) be passed also.  You should
<span class='line'> 73</span>     override this method to convert a field value, such as string, into an
<span class='line'> 74</span>     object value suitable for consumption by the rest of the app.  For example
<span class='line'> 75</span>     you may convert a string into a date or a number.
<span class='line'> 76</span>     
<span class='line'> 77</span>     @param {String} value the field value.  (Usually a String).
<span class='line'> 78</span>     @param {SC.FormView} form The form this field belongs to. (optional)
<span class='line'> 79</span>     @param {SC.View} view The view this value was pulled from.
<span class='line'> 80</span>     @returns {Object} an object suitable for consumption by the app.
<span class='line'> 81</span>   */</span><span class="WHIT">
<span class='line'> 82</span>   </span><span class="NAME">objectForFieldValue</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">view</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 83</span>   
<span class='line'> 84</span>   </span><span class="COMM">// ..........................................</span><span class="WHIT">
<span class='line'> 85</span>   </span><span class="COMM">// VALIDATION PRIMITIVES</span><span class="WHIT">
<span class='line'> 86</span>   </span><span class="COMM">//</span><span class="WHIT">
<span class='line'> 87</span> 
<span class='line'> 88</span>   </span><span class="COMM">/**
<span class='line'> 89</span>     Validate the field value.  
<span class='line'> 90</span>     
<span class='line'> 91</span>     You can implement standard behavior for your validator by using the validate()
<span class='line'> 92</span>     and validateError() methods.  validate() should return NO if the field is not
<span class='line'> 93</span>     valid, YES otherwise.  If you return NO from this method, then the validateError()
<span class='line'> 94</span>     method will be called so you can generate an error object describing the specific problem.
<span class='line'> 95</span> 
<span class='line'> 96</span>     @param {SC.FormView} form the form this view belongs to
<span class='line'> 97</span>     @param {SC.View} field the field to validate.  Responds to fieldValue.
<span class='line'> 98</span>     @returns {Boolean} YES if field is valid.
<span class='line'> 99</span>   */</span><span class="WHIT">
<span class='line'>100</span>   </span><span class="NAME">validate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>101</span> 
<span class='line'>102</span>   </span><span class="COMM">/**
<span class='line'>103</span>     Returns an error object if the field is invalid.
<span class='line'>104</span>   
<span class='line'>105</span>     This is the other standard validator method that can be used to impement basic validation.
<span class='line'>106</span>     Return an error object explaining why the field is not valid.  It will only be called if
<span class='line'>107</span>     validate() returned NO.
<span class='line'>108</span>     
<span class='line'>109</span>     The default implementation of htis method returns a generic error message with the loc
<span class='line'>110</span>     string "Invalid.Generate({fieldValue})".  You can simply define this loc string in
<span class='line'>111</span>     strings.js if you prefer or you can override this method to provide a more specific error message.
<span class='line'>112</span>   
<span class='line'>113</span>     @param {SC.FormView} form the form this view belongs to
<span class='line'>114</span>     @param {SC.View} field the field to validate.  Responds to fieldValue.
<span class='line'>115</span>     @returns {SC.Error} an error object
<span class='line'>116</span>   */</span><span class="WHIT">
<span class='line'>117</span>   </span><span class="NAME">validateError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>118</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">SC.$error</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>119</span>       </span><span class="STRN">"Invalid.General(%@)"</span><span class="PUNC">.</span><span class="NAME">loc</span><span class="PUNC">(</span><span class="NAME">field.get</span><span class="PUNC">(</span><span class="STRN">'fieldValue'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>120</span>       </span><span class="NAME">field.get</span><span class="PUNC">(</span><span class="STRN">'fieldKey'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>121</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>122</span> 
<span class='line'>123</span>   </span><span class="COMM">// ..........................................</span><span class="WHIT">
<span class='line'>124</span>   </span><span class="COMM">// VALIDATION API</span><span class="WHIT">
<span class='line'>125</span>   </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>126</span> 
<span class='line'>127</span>   </span><span class="COMM">/**
<span class='line'>128</span>     Invoked just before the user ends editing of the field.
<span class='line'>129</span> 
<span class='line'>130</span>     This is a primitive validation method.  You can implement the two higher-level
<span class='line'>131</span>     methods (validate() and validateError()) if you prefer.
<span class='line'>132</span>     
<span class='line'>133</span>     The default implementation calls your validate() method and then validateError()
<span class='line'>134</span>     if valiate() returns NO.  This method should return SC.VALIDATE_OK if validation
<span class='line'>135</span>     succeeded or an error object if it fails.
<span class='line'>136</span>   
<span class='line'>137</span>     @param {SC.FormView} form the form for the field
<span class='line'>138</span>     @param {SC.View} field the field to validate
<span class='line'>139</span>     @param {Object} oldValue: the value of the field before the change
<span class='line'>140</span> 
<span class='line'>141</span>     @returns SC.VALIDATE_OK or an error object.
<span class='line'>142</span>   
<span class='line'>143</span>   */</span><span class="WHIT">
<span class='line'>144</span>   </span><span class="NAME">validateChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oldValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>145</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.validate</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">SC.VALIDATE_OK</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.validateError</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>146</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>147</span> 
<span class='line'>148</span>   </span><span class="COMM">/**
<span class='line'>149</span>     Invoked just before the form is submitted.
<span class='line'>150</span>   
<span class='line'>151</span>     This method gives your validators one last chance to perform validation
<span class='line'>152</span>     on the form as a whole.  The default version does the same thing as the 
<span class='line'>153</span>     validateChange() method.
<span class='line'>154</span>   
<span class='line'>155</span>     @param {SC.FormView} form the form for the field
<span class='line'>156</span>     @param {SC.View} field the field to validate
<span class='line'>157</span> 
<span class='line'>158</span>     @returns SC.VALIDATE_OK or an error object.
<span class='line'>159</span>   
<span class='line'>160</span>   */</span><span class="WHIT">  
<span class='line'>161</span>   </span><span class="NAME">validateSubmit</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>162</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.validate</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">SC.VALIDATE_OK</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.validateError</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>163</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>164</span> 
<span class='line'>165</span>   </span><span class="COMM">/**
<span class='line'>166</span>     Invoked 1ms after the user types a key (if a change is allowed).  
<span class='line'>167</span>   
<span class='line'>168</span>     You can use this validate the new partial string and return an error if 
<span class='line'>169</span>     needed. The default will validate a partial only if there was already an 
<span class='line'>170</span>     error. This allows the user to try to get it right before you bug them.
<span class='line'>171</span>   
<span class='line'>172</span>     Unlike the other methods, you should return SC.VALIDATE_NO_CHANGE if you
<span class='line'>173</span>     did not actually validate the partial string.  If you return 
<span class='line'>174</span>     SC.VALIDATE_OK then any showing errors will be hidden.
<span class='line'>175</span>   
<span class='line'>176</span>     @param {SC.FormView} form the form for the field
<span class='line'>177</span>     @param {SC.View} field the field to validate
<span class='line'>178</span> 
<span class='line'>179</span>     @returns SC.VALIDATE_OK, SC.VALIDATE_NO_CHANGE or an error object.
<span class='line'>180</span>   */</span><span class="WHIT">  
<span class='line'>181</span>   </span><span class="NAME">validatePartial</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>182</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">field.get</span><span class="PUNC">(</span><span class="STRN">'isValid'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>183</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.validate</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">SC.VALIDATE_OK</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.validateError</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>184</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">SC.VALIDATE_NO_CHANGE</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>185</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>186</span>   
<span class='line'>187</span>   </span><span class="COMM">/**
<span class='line'>188</span>     Invoked when the user presses a key.  
<span class='line'>189</span>   
<span class='line'>190</span>     This method is used to restrict the letters and numbers the user is 
<span class='line'>191</span>     allowed to enter.  You should not use this method to perform full 
<span class='line'>192</span>     validation on the field.  Instead use validatePartial().
<span class='line'>193</span>   
<span class='line'>194</span>     @param {SC.FormView} form the form for the field
<span class='line'>195</span>     @param {SC.View} field the field to validate
<span class='line'>196</span>     @param {String} char the characters being added
<span class='line'>197</span>     
<span class='line'>198</span>     @returns {Boolean} YES if allowed, NO otherwise
<span class='line'>199</span>   */</span><span class="WHIT">
<span class='line'>200</span>   </span><span class="NAME">validateKeyDown</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">,</span><span class="NAME">charStr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>201</span> 
<span class='line'>202</span>   </span><span class="COMM">// .....................................</span><span class="WHIT">
<span class='line'>203</span>   </span><span class="COMM">// OTHER METHODS</span><span class="WHIT">
<span class='line'>204</span> 
<span class='line'>205</span>   </span><span class="COMM">/**
<span class='line'>206</span>     Called on all validators when they are attached to a field.  
<span class='line'>207</span>   
<span class='line'>208</span>     You can use this to do any setup that you need.  The default does nothing.
<span class='line'>209</span>     
<span class='line'>210</span>     @param {SC.FormView} form the form for the field
<span class='line'>211</span>     @param {SC.View} field the field to validate
<span class='line'>212</span>   */</span><span class="WHIT">
<span class='line'>213</span>   </span><span class="NAME">attachTo</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>214</span> 
<span class='line'>215</span>   </span><span class="COMM">/**
<span class='line'>216</span>     Called on a validator just before it is removed from a field.  You can 
<span class='line'>217</span>     tear down any setup you did for the attachTo() method.
<span class='line'>218</span>     
<span class='line'>219</span>     @param {SC.FormView} form the form for the field
<span class='line'>220</span>     @param {SC.View} field the field to validate
<span class='line'>221</span>   */</span><span class="WHIT">
<span class='line'>222</span>   </span><span class="NAME">detachFrom</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>223</span> 
<span class='line'>224</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>225</span> 
<span class='line'>226</span> </span><span class="NAME">SC.Validator.mixin</span><span class="PUNC">(</span><span class="COMM">/** @scope SC.Validator */</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>227</span> 
<span class='line'>228</span>   </span><span class="COMM">/**
<span class='line'>229</span>     Return value when validation was performed and value is OK.
<span class='line'>230</span>   */</span><span class="WHIT">
<span class='line'>231</span>   </span><span class="NAME">OK</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>232</span>   
<span class='line'>233</span>   </span><span class="COMM">/**
<span class='line'>234</span>     Return value when validation was not performed.
<span class='line'>235</span>   */</span><span class="WHIT">
<span class='line'>236</span>   </span><span class="NAME">NO_CHANGE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">  
<span class='line'>237</span> 
<span class='line'>238</span>   </span><span class="COMM">/**
<span class='line'>239</span>     Invoked by a field whenever a validator is attached to the field.
<span class='line'>240</span>     
<span class='line'>241</span>     The passed validatorKey can be a validator instance, a validator class
<span class='line'>242</span>     or a string naming a validator. To make your validator
<span class='line'>243</span>     visible, you should name your validator under the SC.Validator base.
<span class='line'>244</span>     for example SC.Validator.Number would get used for the 'number' 
<span class='line'>245</span>     validator key.
<span class='line'>246</span>   
<span class='line'>247</span>     This understands validatorKey strings in the following format:
<span class='line'>248</span> 
<span class='line'>249</span>     * 'key' or 'multiple_words' will find validators Key and MultipleWords
<span class='line'>250</span> 
<span class='line'>251</span>     * if you want to share a single validator among multiple fields (for
<span class='line'>252</span>       example to validate that two passwords are the same) set a name inside
<span class='line'>253</span>       brackets. i.e. 'password[pwd]'.
<span class='line'>254</span> 
<span class='line'>255</span>     @param {SC.FormView} form the form for the field
<span class='line'>256</span>     @param {SC.View} field the field to validate
<span class='line'>257</span>     @param {Object} validatorKey the key to validate
<span class='line'>258</span>     
<span class='line'>259</span>     @returns {SC.Validator} validator instance or null
<span class='line'>260</span>   */</span><span class="WHIT">  
<span class='line'>261</span>   </span><span class="NAME">findFor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">validatorKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>262</span>     
<span class='line'>263</span>     </span><span class="COMM">// Convert the validator into a validator instance.</span><span class="WHIT">
<span class='line'>264</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>265</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">validatorKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// nothing to do...</span><span class="WHIT">
<span class='line'>266</span>     
<span class='line'>267</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">validatorKey</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">SC.Validator</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>268</span>       </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validatorKey</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>269</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">validatorKey.isClass</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>270</span>       </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validatorKey.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>271</span>       
<span class='line'>272</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">validatorKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.T_STRING</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>273</span> 
<span class='line'>274</span>       </span><span class="COMM">// extract optional key name</span><span class="WHIT">
<span class='line'>275</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>276</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validatorKey.match</span><span class="PUNC">(</span><span class="REGX">/^(.+)\[(.*)\]/</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>277</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>278</span>         </span><span class="NAME">validatorKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>279</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>280</span>       
<span class='line'>281</span>       </span><span class="COMM">// convert the validatorKey name into a class.</span><span class="WHIT">
<span class='line'>282</span>       </span><span class="NAME">validatorKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validatorKey.classify</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>283</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">validatorClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.Validator</span><span class="PUNC">[</span><span class="NAME">validatorKey</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>284</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">validatorClass</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>285</span>         </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"validator %@ not found for %@"</span><span class="PUNC">.</span><span class="NAME">fmt</span><span class="PUNC">(</span><span class="NAME">validatorKey</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>286</span>       </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>287</span> 
<span class='line'>288</span>         </span><span class="COMM">// if a key was also passed, then find the validator in the list of</span><span class="WHIT">
<span class='line'>289</span>         </span><span class="COMM">// validators for the form.  Otherwise, just create a new instance.</span><span class="WHIT">
<span class='line'>290</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">form</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>291</span>           </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"named validator (%@) could not be found for field %@ because the field does not belong to a form"</span><span class="PUNC">.</span><span class="NAME">fmt</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>292</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>293</span>         
<span class='line'>294</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">form._validatorHash</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">form._validatorHash</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>295</span>         </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">form._validatorHash</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>296</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">validator</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validatorClass.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>297</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">form._validatorHash</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>298</span>       </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validatorClass.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>299</span>     </span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'>300</span>     
<span class='line'>301</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>302</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>303</span>   
<span class='line'>304</span>   </span><span class="COMM">/**
<span class='line'>305</span>     Convenience class method to call the fieldValueForObject() instance
<span class='line'>306</span>     method you define in your subclass.
<span class='line'>307</span>   */</span><span class="WHIT">
<span class='line'>308</span>   </span><span class="NAME">fieldValueForObject</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>309</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.prototype</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.prototype.fieldValueForObject</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>310</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.prototype.fieldValueForObject</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">,</span><span class="NAME">form</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>311</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>312</span>     </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>313</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>314</span>   
<span class='line'>315</span>   </span><span class="COMM">/**
<span class='line'>316</span>     Convenience class method to call the objectForFieldValue() instance
<span class='line'>317</span>     method you define in your subclass.
<span class='line'>318</span>   */</span><span class="WHIT">
<span class='line'>319</span>   </span><span class="NAME">objectForFieldValue</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>320</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.prototype</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.prototype.objectForFieldValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>321</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.prototype.objectForFieldValue</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">form</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>322</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>323</span>     </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>324</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>325</span>   
<span class='line'>326</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>327</span> </span></pre></body></html>