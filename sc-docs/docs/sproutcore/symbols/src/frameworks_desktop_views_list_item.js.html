<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="COMM">// Project:   SproutCore - JavaScript Application Framework</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="COMM">// Copyright: Â©2006-2009 Sprout Systems, Inc. and contributors.</span><span class="WHIT">
<span class='line'>  4</span> </span><span class="COMM">//            portions copyright @2009 Apple Inc.</span><span class="WHIT">
<span class='line'>  5</span> </span><span class="COMM">// License:   Licensed under MIT license (see license.js)</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  7</span> 
<span class='line'>  8</span> </span><span class="NAME">SC.LIST_ITEM_ACTION_CANCEL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'sc-list-item-cancel-action'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  9</span> </span><span class="NAME">SC.LIST_ITEM_ACTION_REFRESH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'sc-list-item-cancel-refresh'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 10</span> </span><span class="NAME">SC.LIST_ITEM_ACTION_EJECT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'sc-list-item-cancel-eject'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 11</span> 
<span class='line'> 12</span> </span><span class="COMM">/**
<span class='line'> 13</span>   @class
<span class='line'> 14</span>   
<span class='line'> 15</span>   Many times list items need to display a lot more than just a label of text.
<span class='line'> 16</span>   You often need to include checkboxes, icons, right icons, extra counts and 
<span class='line'> 17</span>   an action or warning icon to the far right. 
<span class='line'> 18</span>   
<span class='line'> 19</span>   A ListItemView can implement all of this for you in a more efficient way 
<span class='line'> 20</span>   than you might get if you simply put together a list item on your own using
<span class='line'> 21</span>   views.
<span class='line'> 22</span>   
<span class='line'> 23</span>   @extends SC.View
<span class='line'> 24</span>   @extends SC.Control
<span class='line'> 25</span>   @extends SC.Editable
<span class='line'> 26</span>   @extends SC.StaticLayout
<span class='line'> 27</span>   @since SproutCore 1.0
<span class='line'> 28</span> */</span><span class="WHIT">
<span class='line'> 29</span> </span><span class="NAME">SC.ListItemView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.View.extend</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'> 30</span>     </span><span class="NAME">SC.StaticLayout</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 31</span>     </span><span class="NAME">SC.Control</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 32</span> </span><span class="COMM">/** @scope SC.ListItemView.prototype */</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 33</span>   
<span class='line'> 34</span>   </span><span class="NAME">classNames</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'sc-list-item-view'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 35</span>   
<span class='line'> 36</span>   </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'> 37</span>   </span><span class="COMM">// KEY PROPERTIES</span><span class="WHIT">
<span class='line'> 38</span>   </span><span class="COMM">// </span><span class="WHIT">
<span class='line'> 39</span>   
<span class='line'> 40</span>   </span><span class="COMM">/**
<span class='line'> 41</span>     The content object the list item will display.
<span class='line'> 42</span>     
<span class='line'> 43</span>     @type SC.Object
<span class='line'> 44</span>   */</span><span class="WHIT">
<span class='line'> 45</span>   </span><span class="NAME">content</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 46</span>   
<span class='line'> 47</span>   </span><span class="COMM">/**
<span class='line'> 48</span>     (displayDelegate) True if you want the item view to display an icon.
<span class='line'> 49</span>     
<span class='line'> 50</span>     If false, the icon on the list item view will be hidden.  Otherwise,
<span class='line'> 51</span>     space will be left for the icon next to the list item view.
<span class='line'> 52</span>   */</span><span class="WHIT">
<span class='line'> 53</span>   </span><span class="NAME">hasContentIcon</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 54</span> 
<span class='line'> 55</span>   </span><span class="COMM">/**
<span class='line'> 56</span>     (displayDelegate) True if you want the item view to display a right icon.
<span class='line'> 57</span>     
<span class='line'> 58</span>     If false, the icon on the list item view will be hidden.  Otherwise,
<span class='line'> 59</span>     space will be left for the icon next to the list item view.
<span class='line'> 60</span>   */</span><span class="WHIT">
<span class='line'> 61</span>   </span><span class="NAME">hasContentRightIcon</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 62</span>   
<span class='line'> 63</span>   </span><span class="COMM">/**
<span class='line'> 64</span>     (displayDelegate) True if you want space to be allocated for a branch 
<span class='line'> 65</span>     arrow.
<span class='line'> 66</span>     
<span class='line'> 67</span>     If false, the space for the branch arrow will be collapsed.
<span class='line'> 68</span>   */</span><span class="WHIT">
<span class='line'> 69</span>   </span><span class="NAME">hasContentBranch</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 70</span>   
<span class='line'> 71</span>   </span><span class="COMM">/**
<span class='line'> 72</span>     (displayDelegate) The name of the property used for the checkbox value.
<span class='line'> 73</span>     
<span class='line'> 74</span>     The checkbox will only be visible if this key is not null.
<span class='line'> 75</span>     
<span class='line'> 76</span>     @type {String}
<span class='line'> 77</span>   */</span><span class="WHIT">
<span class='line'> 78</span>   </span><span class="NAME">contentCheckboxKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 79</span>   
<span class='line'> 80</span>   </span><span class="COMM">/**
<span class='line'> 81</span>     (displayDelegate) Property key to use for the icon url
<span class='line'> 82</span> 
<span class='line'> 83</span>     This property will be checked on the content object to determine the 
<span class='line'> 84</span>     icon to display.  It must return either a URL or a CSS class name.
<span class='line'> 85</span>   */</span><span class="WHIT">
<span class='line'> 86</span>   </span><span class="NAME">contentIconKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 87</span>  
<span class='line'> 88</span>   </span><span class="COMM">/**
<span class='line'> 89</span>     (displayDelegate) Property key to use for the right icon url
<span class='line'> 90</span> 
<span class='line'> 91</span>     This property will be checked on the content object to determine the 
<span class='line'> 92</span>     icon to display.  It must return either a URL or a CSS class name.
<span class='line'> 93</span>   */</span><span class="WHIT">
<span class='line'> 94</span>   </span><span class="NAME">contentRightIconKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 95</span>   
<span class='line'> 96</span>   </span><span class="COMM">/**
<span class='line'> 97</span>     (displayDelegate) The name of the property used for label itself
<span class='line'> 98</span>     
<span class='line'> 99</span>     If null, then the content object itself will be used..
<span class='line'>100</span>   */</span><span class="WHIT">
<span class='line'>101</span>   </span><span class="NAME">contentValueKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>102</span>   
<span class='line'>103</span>   </span><span class="COMM">/**
<span class='line'>104</span>     IF true, the label value will be escaped to avoid HTML injection attacks.
<span class='line'>105</span>     You should only disable this option if you are sure you will only 
<span class='line'>106</span>     display content that is already escaped and you need the added 
<span class='line'>107</span>     performance gain.
<span class='line'>108</span>   */</span><span class="WHIT">
<span class='line'>109</span>   </span><span class="NAME">escapeHTML</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>110</span>   
<span class='line'>111</span>   </span><span class="COMM">/**
<span class='line'>112</span>     (displayDelegate) The name of the property used to find the count of 
<span class='line'>113</span>     unread items. 
<span class='line'>114</span>     
<span class='line'>115</span>     The count will only be visible if this property is not null and the 
<span class='line'>116</span>     returned value is not 0.
<span class='line'>117</span>   */</span><span class="WHIT">
<span class='line'>118</span>   </span><span class="NAME">contentUnreadCountKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>119</span>   
<span class='line'>120</span>   </span><span class="COMM">/**
<span class='line'>121</span>     (displayDelegate) The name of the property used to determine if the item
<span class='line'>122</span>     is a branch or leaf (i.e. if the branch icon should be displayed to the
<span class='line'>123</span>     right edge.)
<span class='line'>124</span>     
<span class='line'>125</span>     If this is null, then the branch view will be completely hidden.
<span class='line'>126</span>     Otherwise space will be allocated for it.
<span class='line'>127</span>   */</span><span class="WHIT">
<span class='line'>128</span>   </span><span class="NAME">contentIsBranchKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>129</span>   
<span class='line'>130</span> 
<span class='line'>131</span>   </span><span class="COMM">/**
<span class='line'>132</span>     YES if the item view is currently editing.
<span class='line'>133</span>   */</span><span class="WHIT">
<span class='line'>134</span>   </span><span class="NAME">isEditing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>135</span>   
<span class='line'>136</span>   </span><span class="COMM">/**
<span class='line'>137</span>     Indent to use when rendering a list item with an outline level > 0.  The
<span class='line'>138</span>     left edge of the list item will be indented by this amount for each 
<span class='line'>139</span>     outline level.
<span class='line'>140</span>   */</span><span class="WHIT">
<span class='line'>141</span>   </span><span class="NAME">outlineIndent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>142</span>   
<span class='line'>143</span>   </span><span class="COMM">/**
<span class='line'>144</span>     Outline level for this list item.  Usually set by the collection view.
<span class='line'>145</span>   */</span><span class="WHIT">
<span class='line'>146</span>   </span><span class="NAME">outlineLevel</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>147</span>   
<span class='line'>148</span>   </span><span class="COMM">/**
<span class='line'>149</span>     Disclosure state for this list item.  Usually set by the collection view
<span class='line'>150</span>     when the list item is created.
<span class='line'>151</span>   */</span><span class="WHIT">
<span class='line'>152</span>   </span><span class="NAME">disclosureState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.LEAF_NODE</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>153</span> 
<span class='line'>154</span>   </span><span class="COMM">/**
<span class='line'>155</span>     The validator to use for the inline text field created when the list item
<span class='line'>156</span>     is edited.
<span class='line'>157</span>   */</span><span class="WHIT">
<span class='line'>158</span>   </span><span class="NAME">validator</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>159</span> 
<span class='line'>160</span>   </span><span class="NAME">contentPropertyDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>161</span>     </span><span class="COMM">//if (this.get('isEditing')) this.discardEditing() ;</span><span class="WHIT">
<span class='line'>162</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'contentIsEditable'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">this.contentIsEditable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>163</span>       </span><span class="NAME">this.notifyPropertyChange</span><span class="PUNC">(</span><span class="STRN">'contentIsEditable'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>164</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>165</span>     
<span class='line'>166</span>     </span><span class="NAME">this.displayDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>167</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>168</span>   
<span class='line'>169</span>   </span><span class="COMM">/**
<span class='line'>170</span>     Determines if content is editable or not.  Checkboxes and other related
<span class='line'>171</span>     components will render disabled if an item is not editable.
<span class='line'>172</span>   */</span><span class="WHIT">
<span class='line'>173</span>   </span><span class="NAME">contentIsEditable</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>174</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>175</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content.get</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="STRN">'isEditable'</span><span class="PUNC">)</span><span class="PUNC">!==</span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>176</span>   </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>177</span>   
<span class='line'>178</span>   </span><span class="COMM">/**
<span class='line'>179</span>     Fills the passed html-array with strings that can be joined to form the
<span class='line'>180</span>     innerHTML of the receiver element.  Also populates an array of classNames
<span class='line'>181</span>     to set on the outer element.
<span class='line'>182</span>     
<span class='line'>183</span>     @param {SC.RenderContext} context
<span class='line'>184</span>     @param {Boolean} firstTime
<span class='line'>185</span>     @returns {void}
<span class='line'>186</span>   */</span><span class="WHIT">
<span class='line'>187</span>   </span><span class="NAME">render</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">firstTime</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>188</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>189</span>         </span><span class="NAME">del</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.displayDelegate</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>190</span>         </span><span class="NAME">level</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'outlineLevel'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>191</span>         </span><span class="NAME">indent</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'outlineIndent'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>192</span>         </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">working</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">classArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>193</span>     
<span class='line'>194</span>     </span><span class="COMM">// add alternating row classes</span><span class="WHIT">
<span class='line'>195</span>     </span><span class="NAME">classArray.push</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'contentIndex'</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'even'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'odd'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>196</span>     </span><span class="NAME">context.setClass</span><span class="PUNC">(</span><span class="STRN">'disabled'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEnabled'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>197</span> 
<span class='line'>198</span>     </span><span class="COMM">// outline level wrapper</span><span class="WHIT">
<span class='line'>199</span>     </span><span class="NAME">working</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">context.begin</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">"sc-outline"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>200</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">level</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">indent</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">working.addStyle</span><span class="PUNC">(</span><span class="STRN">"left"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">indent</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">level</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>201</span> 
<span class='line'>202</span>     </span><span class="COMM">// handle disclosure triangle</span><span class="WHIT">
<span class='line'>203</span>     </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'disclosureState'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>204</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">SC.LEAF_NODE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>205</span>       </span><span class="NAME">this.renderDisclosure</span><span class="PUNC">(</span><span class="NAME">working</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>206</span>       </span><span class="NAME">classArray.push</span><span class="PUNC">(</span><span class="STRN">'has-disclosure'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>207</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>208</span>     
<span class='line'>209</span>     
<span class='line'>210</span>     </span><span class="COMM">// handle checkbox</span><span class="WHIT">
<span class='line'>211</span>     </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'contentCheckboxKey'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>212</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>213</span>       </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content.get</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>214</span>       </span><span class="NAME">this.renderCheckbox</span><span class="PUNC">(</span><span class="NAME">working</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>215</span>       </span><span class="NAME">classArray.push</span><span class="PUNC">(</span><span class="STRN">'has-checkbox'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>216</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>217</span>     
<span class='line'>218</span>     </span><span class="COMM">// handle icon</span><span class="WHIT">
<span class='line'>219</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'hasContentIcon'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>220</span>       </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'contentIconKey'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>221</span>       </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content.get</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>222</span>       
<span class='line'>223</span>       </span><span class="NAME">this.renderIcon</span><span class="PUNC">(</span><span class="NAME">working</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>224</span>       </span><span class="NAME">classArray.push</span><span class="PUNC">(</span><span class="STRN">'has-icon'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">      
<span class='line'>225</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>226</span>     
<span class='line'>227</span>     </span><span class="COMM">// handle label -- always invoke</span><span class="WHIT">
<span class='line'>228</span>     </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'contentValueKey'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>229</span>     </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content.get</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>230</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">SC.T_STRING</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>231</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'escapeHTML'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.RenderContext.escapeHTML</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>232</span>     </span><span class="NAME">this.renderLabel</span><span class="PUNC">(</span><span class="NAME">working</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>233</span> 
<span class='line'>234</span>     </span><span class="COMM">// handle right icon</span><span class="WHIT">
<span class='line'>235</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'hasContentRightIcon'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>236</span>       </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'contentRightIconKey'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>237</span>       </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content.get</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>238</span>       
<span class='line'>239</span>       </span><span class="NAME">this.renderRightIcon</span><span class="PUNC">(</span><span class="NAME">working</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>240</span>       </span><span class="NAME">classArray.push</span><span class="PUNC">(</span><span class="STRN">'has-right-icon'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>241</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>242</span>     
<span class='line'>243</span>     </span><span class="COMM">// handle unread count</span><span class="WHIT">
<span class='line'>244</span>     </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'contentUnreadCountKey'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>245</span>     </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content.get</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>246</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>247</span>       </span><span class="NAME">this.renderCount</span><span class="PUNC">(</span><span class="NAME">working</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>248</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">digits</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'zero'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'one'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'two'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'three'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'four'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'five'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>249</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>250</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">digitsLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">digits.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>251</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">digit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">valueLength</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">digitsLength</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">digits</span><span class="PUNC">[</span><span class="NAME">valueLength</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">digits</span><span class="PUNC">[</span><span class="NAME">digitsLength</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>252</span>       </span><span class="NAME">classArray.push</span><span class="PUNC">(</span><span class="STRN">'has-count '</span><span class="PUNC">+</span><span class="NAME">digit</span><span class="PUNC">+</span><span class="STRN">'-digit'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>253</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>254</span>     
<span class='line'>255</span>     </span><span class="COMM">// handle action </span><span class="WHIT">
<span class='line'>256</span>     </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'listItemActionProperty'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>257</span>     </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content.get</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>258</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>259</span>       </span><span class="NAME">this.renderAction</span><span class="PUNC">(</span><span class="NAME">working</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>260</span>       </span><span class="NAME">classArray.push</span><span class="PUNC">(</span><span class="STRN">'has-action'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>261</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>262</span>     
<span class='line'>263</span>     </span><span class="COMM">// handle branch</span><span class="WHIT">
<span class='line'>264</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'hasContentBranch'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>265</span>       </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'contentIsBranchKey'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>266</span>       </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content.get</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>267</span>       </span><span class="NAME">this.renderBranch</span><span class="PUNC">(</span><span class="NAME">working</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>268</span>       </span><span class="NAME">classArray.push</span><span class="PUNC">(</span><span class="STRN">'has-branch'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>269</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>270</span>     </span><span class="NAME">context.addClass</span><span class="PUNC">(</span><span class="NAME">classArray</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>271</span>     </span><span class="NAME">context</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">working.end</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>272</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>273</span>   
<span class='line'>274</span>   </span><span class="COMM">/**
<span class='line'>275</span>     Adds a disclosure triangle with the appropriate display to the content.
<span class='line'>276</span>     This method will only be called if the disclosure state of the view is
<span class='line'>277</span>     something other than SC.LEAF_NODE.
<span class='line'>278</span> 
<span class='line'>279</span>     @param {SC.RenderContext} context the render context
<span class='line'>280</span>     @param {Boolean} state YES, NO or SC.MIXED_STATE
<span class='line'>281</span>     @returns {void}
<span class='line'>282</span>   */</span><span class="WHIT">
<span class='line'>283</span>   </span><span class="NAME">renderDisclosure</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>284</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.BRANCH_OPEN</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"open"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"closed"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>285</span>         </span><span class="NAME">cache</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._scli_disclosureHtml</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>286</span>         </span><span class="NAME">html</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>287</span>         
<span class='line'>288</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">cache</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">cache</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.constructor.prototype._scli_disclosureHtml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>289</span>     </span><span class="NAME">html</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cache</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>290</span> 
<span class='line'>291</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">html</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>292</span>       </span><span class="NAME">html</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cache</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'&lt;img src="'</span><span class="PUNC">+</span><span class="NAME">SC.BLANK_IMAGE_URL</span><span class="PUNC">+</span><span class="STRN">'" class="disclosure button '</span><span class="PUNC">+</span><span class="NAME">key</span><span class="PUNC">+</span><span class="STRN">'" />'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>293</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>294</span>     
<span class='line'>295</span>     </span><span class="NAME">context.push</span><span class="PUNC">(</span><span class="NAME">html</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>296</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>297</span>   
<span class='line'>298</span>   </span><span class="COMM">/**
<span class='line'>299</span>     Adds a checkbox with the appropriate state to the content.  This method
<span class='line'>300</span>     will only be called if the list item view is supposed to have a 
<span class='line'>301</span>     checkbox.
<span class='line'>302</span>     
<span class='line'>303</span>     @param {SC.RenderContext} context the render context
<span class='line'>304</span>     @param {Boolean} state YES, NO or SC.MIXED_STATE
<span class='line'>305</span>     @returns {void}
<span class='line'>306</span>   */</span><span class="WHIT">
<span class='line'>307</span>   </span><span class="NAME">renderCheckbox</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>308</span>     
<span class='line'>309</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.MIXED_STATE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"mixed"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"sel"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"nosel"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>310</span>         </span><span class="NAME">cache</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._scli_checkboxHtml</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>311</span>         </span><span class="NAME">isEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'contentIsEditable'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEnabled'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>312</span>         </span><span class="NAME">html</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">classArray</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>313</span>         
<span class='line'>314</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isEnabled</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.keyFor</span><span class="PUNC">(</span><span class="STRN">'disabled'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>315</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">cache</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">cache</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.constructor.prototype._scli_checkboxHtml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>316</span>     </span><span class="NAME">html</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cache</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>317</span>     
<span class='line'>318</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">html</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>319</span>       </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.RenderContext</span><span class="PUNC">(</span><span class="STRN">'div'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'role'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'button'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>320</span>         </span><span class="PUNC">.</span><span class="NAME">classNames</span><span class="PUNC">(</span><span class="NAME">SC.clone</span><span class="PUNC">(</span><span class="NAME">SC.CheckboxView.prototype.classNames</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>321</span> 
<span class='line'>322</span>       </span><span class="COMM">// set state on html</span><span class="WHIT">
<span class='line'>323</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.MIXED_STATE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">classArray.push</span><span class="PUNC">(</span><span class="STRN">'mixed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>324</span>       </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">classArray.push</span><span class="PUNC">(</span><span class="STRN">'sel'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>325</span>       
<span class='line'>326</span>       </span><span class="COMM">// disabled</span><span class="WHIT">
<span class='line'>327</span>       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isEnabled</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">classArray.push</span><span class="PUNC">(</span><span class="STRN">'disabled'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>328</span>       
<span class='line'>329</span>       </span><span class="NAME">tmp.addClass</span><span class="PUNC">(</span><span class="NAME">classArray</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>330</span> 
<span class='line'>331</span>       </span><span class="COMM">// now add inner content.  note we do not add a real checkbox because</span><span class="WHIT">
<span class='line'>332</span>       </span><span class="COMM">// we don't want to have to setup a change observer on it.</span><span class="WHIT">
<span class='line'>333</span>       </span><span class="NAME">tmp.push</span><span class="PUNC">(</span><span class="STRN">'&lt;span class="button">&lt;/span>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>334</span> 
<span class='line'>335</span>       </span><span class="COMM">// apply edit</span><span class="WHIT">
<span class='line'>336</span>       </span><span class="NAME">html</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cache</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmp.join</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>337</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>338</span>     
<span class='line'>339</span>     </span><span class="NAME">context.push</span><span class="PUNC">(</span><span class="NAME">html</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>340</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>341</span>   
<span class='line'>342</span>   </span><span class="COMM">/** 
<span class='line'>343</span>     Generates an icon for the label based on the content.  This method will
<span class='line'>344</span>     only be called if the list item view has icons enabled.  You can override
<span class='line'>345</span>     this method to display your own type of icon if desired.
<span class='line'>346</span>     
<span class='line'>347</span>     @param {SC.RenderContext} context the render context
<span class='line'>348</span>     @param {String} icon a URL or class name.
<span class='line'>349</span>     @returns {void}
<span class='line'>350</span>   */</span><span class="WHIT">
<span class='line'>351</span>   </span><span class="NAME">renderIcon</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">icon</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>352</span>     </span><span class="COMM">// get a class name and url to include if relevant</span><span class="WHIT">
<span class='line'>353</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">classArray</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>354</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">icon</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">SC.ImageView.valueIsUrl</span><span class="PUNC">(</span><span class="NAME">icon</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>355</span>       </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">icon</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>356</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>357</span>       </span><span class="NAME">className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">icon</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.BLANK_IMAGE_URL</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>358</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>359</span>     
<span class='line'>360</span>     </span><span class="COMM">// generate the img element...</span><span class="WHIT">
<span class='line'>361</span>     </span><span class="NAME">classArray.push</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">,</span><span class="STRN">'icon'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>362</span>     </span><span class="NAME">context.begin</span><span class="PUNC">(</span><span class="STRN">'img'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>363</span>             </span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="NAME">classArray</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>364</span>             </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'src'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>365</span>             </span><span class="PUNC">.</span><span class="NAME">end</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>366</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>367</span>   
<span class='line'>368</span>   </span><span class="COMM">/** 
<span class='line'>369</span>    Generates a label based on the content.  You can override this method to 
<span class='line'>370</span>    display your own type of icon if desired.
<span class='line'>371</span>    
<span class='line'>372</span>    @param {SC.RenderContext} context the render context
<span class='line'>373</span>    @param {String} label the label to display, already HTML escaped.
<span class='line'>374</span>    @returns {void}
<span class='line'>375</span>   */</span><span class="WHIT">
<span class='line'>376</span>   </span><span class="NAME">renderLabel</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">label</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>377</span>     </span><span class="NAME">context.push</span><span class="PUNC">(</span><span class="STRN">'&lt;label>'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">label</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'&lt;/label>'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>378</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>379</span>   
<span class='line'>380</span>   </span><span class="COMM">/**
<span class='line'>381</span>     Finds and retrieves the element containing the label.  This is used
<span class='line'>382</span>     for inline editing.  The default implementation returns a CoreQuery
<span class='line'>383</span>     selecting any label elements.   If you override renderLabel() you 
<span class='line'>384</span>     probably need to override this as well.
<span class='line'>385</span>   
<span class='line'>386</span>     @returns {SC.CoreQuery} CQ object selecting label elements
<span class='line'>387</span>   */</span><span class="WHIT">
<span class='line'>388</span>   </span><span class="NAME">$label</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>389</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.$</span><span class="PUNC">(</span><span class="STRN">'label'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>390</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>391</span> 
<span class='line'>392</span>   </span><span class="COMM">/** 
<span class='line'>393</span>     Generates a right icon for the label based on the content.  This method will
<span class='line'>394</span>     only be called if the list item view has icons enabled.  You can override
<span class='line'>395</span>     this method to display your own type of icon if desired.
<span class='line'>396</span>     
<span class='line'>397</span>     @param {SC.RenderContext} context the render context
<span class='line'>398</span>     @param {String} icon a URL or class name.
<span class='line'>399</span>     @returns {void}
<span class='line'>400</span>   */</span><span class="WHIT">
<span class='line'>401</span>   </span><span class="NAME">renderRightIcon</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">icon</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>402</span>     </span><span class="COMM">// get a class name and url to include if relevant</span><span class="WHIT">
<span class='line'>403</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">classArray</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>404</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">icon</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">SC.ImageView.valueIsUrl</span><span class="PUNC">(</span><span class="NAME">icon</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>405</span>       </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">icon</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>406</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>407</span>       </span><span class="NAME">className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">icon</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.BLANK_IMAGE_URL</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>408</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>409</span>     
<span class='line'>410</span>     </span><span class="COMM">// generate the img element...</span><span class="WHIT">
<span class='line'>411</span>     </span><span class="NAME">classArray.push</span><span class="PUNC">(</span><span class="STRN">'right-icon'</span><span class="PUNC">,</span><span class="NAME">className</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>412</span>     </span><span class="NAME">context.begin</span><span class="PUNC">(</span><span class="STRN">'img'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>413</span>       </span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="NAME">classArray</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>414</span>       </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'src'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>415</span>     </span><span class="PUNC">.</span><span class="NAME">end</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>416</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>417</span>   
<span class='line'>418</span>   </span><span class="COMM">/** 
<span class='line'>419</span>    Generates an unread or other count for the list item.  This method will
<span class='line'>420</span>    only be called if the list item view has counts enabled.  You can 
<span class='line'>421</span>    override this method to display your own type of counts if desired.
<span class='line'>422</span>    
<span class='line'>423</span>    @param {SC.RenderContext} context the render context
<span class='line'>424</span>    @param {Number} count the count
<span class='line'>425</span>    @returns {void}
<span class='line'>426</span>   */</span><span class="WHIT">
<span class='line'>427</span>   </span><span class="NAME">renderCount</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">count</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>428</span>     </span><span class="NAME">context.push</span><span class="PUNC">(</span><span class="STRN">'&lt;span class="count">&lt;span class="inner">'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>429</span>                   </span><span class="NAME">count.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">'&lt;/span>&lt;/span>'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>430</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>431</span>   
<span class='line'>432</span>   </span><span class="COMM">/**
<span class='line'>433</span>     Generates the html string used to represent the action item for your 
<span class='line'>434</span>     list item.  override this to return your own custom HTML
<span class='line'>435</span>     
<span class='line'>436</span>     @param {SC.RenderContext} context the render context
<span class='line'>437</span>     @param {String} actionClassName the name of the action item
<span class='line'>438</span>     @returns {void}
<span class='line'>439</span>   */</span><span class="WHIT">
<span class='line'>440</span>   </span><span class="NAME">renderAction</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">actionClassName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>441</span>     </span><span class="NAME">context.push</span><span class="PUNC">(</span><span class="STRN">'&lt;img src="'</span><span class="PUNC">,</span><span class="NAME">SC.BLANK_IMAGE_URL</span><span class="PUNC">,</span><span class="STRN">'" class="action" />'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>442</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>443</span>   
<span class='line'>444</span>   </span><span class="COMM">/**
<span class='line'>445</span>    Generates the string used to represent the branch arrow. override this to 
<span class='line'>446</span>    return your own custom HTML
<span class='line'>447</span>    
<span class='line'>448</span>    @param {SC.RenderContext} context the render context
<span class='line'>449</span>    @param {Boolean} hasBranch YES if the item has a branch
<span class='line'>450</span>    @returns {void}
<span class='line'>451</span>   */</span><span class="WHIT">
<span class='line'>452</span>   </span><span class="NAME">renderBranch</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hasBranch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>453</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">classArray</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>454</span>     </span><span class="NAME">classArray.push</span><span class="PUNC">(</span><span class="STRN">'branch'</span><span class="PUNC">,</span><span class="NAME">hasBranch</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'branch-visible'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'branch-hidden'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>455</span>     </span><span class="NAME">context.begin</span><span class="PUNC">(</span><span class="STRN">'span'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>456</span>           </span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="NAME">classArray</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>457</span>           </span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="STRN">'&nbsp;'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>458</span>           </span><span class="PUNC">.</span><span class="NAME">end</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>459</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>460</span>   
<span class='line'>461</span>   </span><span class="COMM">/** 
<span class='line'>462</span>     Determines if the event occured inside an element with the specified
<span class='line'>463</span>     classname or not.
<span class='line'>464</span>   */</span><span class="WHIT">
<span class='line'>465</span>   </span><span class="NAME">_isInsideElementWithClassName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>466</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'layer'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>467</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">layer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// no layer yet -- nothing to do</span><span class="WHIT">
<span class='line'>468</span>     
<span class='line'>469</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.$</span><span class="PUNC">(</span><span class="NAME">evt.target</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>470</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">classNames</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>471</span>     </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>472</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el.hasClass</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>473</span>       </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.parent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>474</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>475</span>     </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//avoid memory leaks</span><span class="WHIT">
<span class='line'>476</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>477</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>478</span>   
<span class='line'>479</span>   </span><span class="COMM">/** @private
<span class='line'>480</span>     Returns YES if the list item has a checkbox and the event occurred 
<span class='line'>481</span>     inside of it.
<span class='line'>482</span>   */</span><span class="WHIT">
<span class='line'>483</span>   </span><span class="NAME">_isInsideCheckbox</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>484</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.displayDelegate</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>485</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">checkboxKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'contentCheckboxKey'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>486</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">checkboxKey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this._isInsideElementWithClassName</span><span class="PUNC">(</span><span class="STRN">'sc-checkbox-view'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>487</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>488</span>   
<span class='line'>489</span>   </span><span class="COMM">/** @private 
<span class='line'>490</span>     Returns YES if the list item has a disclosure triangle and the event 
<span class='line'>491</span>     occurred inside of it.
<span class='line'>492</span>   */</span><span class="WHIT">
<span class='line'>493</span>   </span><span class="NAME">_isInsideDisclosure</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>494</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'disclosureState'</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="NAME">SC.LEAF_NODE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>495</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._isInsideElementWithClassName</span><span class="PUNC">(</span><span class="STRN">'disclosure'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>496</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>497</span>   
<span class='line'>498</span>   </span><span class="COMM">/** @private 
<span class='line'>499</span>     Returns YES if the list item has a right icon and the event 
<span class='line'>500</span>     occurred inside of it.
<span class='line'>501</span>   */</span><span class="WHIT">
<span class='line'>502</span>   </span><span class="NAME">_isInsideRightIcon</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>503</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.displayDelegate</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>504</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rightIconKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'hasContentRightIcon'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>505</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rightIconKey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this._isInsideElementWithClassName</span><span class="PUNC">(</span><span class="STRN">'right-icon'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>506</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>507</span>   
<span class='line'>508</span>   </span><span class="COMM">/** @private 
<span class='line'>509</span>   mouseDown is handled only for clicks on the checkbox view or or action
<span class='line'>510</span>   button.
<span class='line'>511</span>   */</span><span class="WHIT">
<span class='line'>512</span>   </span><span class="NAME">mouseDown</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>513</span>     
<span class='line'>514</span>     </span><span class="COMM">// if content is not editable, then always let collection view handle the</span><span class="WHIT">
<span class='line'>515</span>     </span><span class="COMM">// event.</span><span class="WHIT">
<span class='line'>516</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'contentIsEditable'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>517</span>     
<span class='line'>518</span>     </span><span class="COMM">// if occurred inside checkbox, item view should handle the event.</span><span class="WHIT">
<span class='line'>519</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._isInsideCheckbox</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>520</span>       </span><span class="NAME">this._addCheckboxActiveState</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>521</span>       </span><span class="NAME">this._isMouseDownOnCheckbox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>522</span>       </span><span class="NAME">this._isMouseInsideCheckbox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>523</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// listItem should handle this event</span><span class="WHIT">
<span class='line'>524</span> 
<span class='line'>525</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._isInsideDisclosure</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>526</span>       </span><span class="NAME">this._addDisclosureActiveState</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>527</span>       </span><span class="NAME">this._isMouseDownOnDisclosure</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>528</span>       </span><span class="NAME">this._isMouseInsideDisclosure</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>529</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>530</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._isInsideRightIcon</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>531</span>       </span><span class="NAME">this._addRightIconActiveState</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>532</span>       </span><span class="NAME">this._isMouseDownOnRightIcon</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>533</span>       </span><span class="NAME">this._isMouseInsideRightIcon</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>534</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>535</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>536</span>     
<span class='line'>537</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// let the collection view handle this event</span><span class="WHIT">
<span class='line'>538</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>539</span>   
<span class='line'>540</span>   </span><span class="NAME">mouseUp</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>541</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">checkboxKey</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">set</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>542</span> 
<span class='line'>543</span>     </span><span class="COMM">// if mouse was down in checkbox -- then handle mouse up, otherwise </span><span class="WHIT">
<span class='line'>544</span>     </span><span class="COMM">// allow parent view to handle event.</span><span class="WHIT">
<span class='line'>545</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._isMouseDownOnCheckbox</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>546</span>    
<span class='line'>547</span>       </span><span class="COMM">// update only if mouse inside on mouse up...</span><span class="WHIT">
<span class='line'>548</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._isInsideCheckbox</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>549</span>         </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.displayDelegate</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>550</span>         </span><span class="NAME">checkboxKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'contentCheckboxKey'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>551</span>         </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>552</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>553</span>           </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">checkboxKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>554</span>           </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.MIXED_STATE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>555</span>           </span><span class="NAME">content.set</span><span class="PUNC">(</span><span class="NAME">checkboxKey</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// update content</span><span class="WHIT">
<span class='line'>556</span>           </span><span class="NAME">this.displayDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// repaint view...</span><span class="WHIT">
<span class='line'>557</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>558</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>559</span>  
<span class='line'>560</span>       </span><span class="NAME">this._removeCheckboxActiveState</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>561</span>       </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>562</span>     
<span class='line'>563</span>     </span><span class="COMM">// if mouse as down on disclosure -- handle mosue up.  otherwise pass on</span><span class="WHIT">
<span class='line'>564</span>     </span><span class="COMM">// to parent.</span><span class="WHIT">
<span class='line'>565</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._isMouseDownOnDisclosure</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>566</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._isInsideDisclosure</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>567</span>         </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'disclosureState'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>568</span>         </span><span class="NAME">idx</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'contentIndex'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>569</span>         </span><span class="NAME">set</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">SC.IndexSet.create</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>570</span>         </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'displayDelegate'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>571</span>         
<span class='line'>572</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.BRANCH_OPEN</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>573</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">set</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">del.collapse</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">del.collapse</span><span class="PUNC">(</span><span class="NAME">set</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>574</span>           </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'disclosureState'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SC.BRANCH_CLOSED</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>575</span>           </span><span class="NAME">this.displayDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>576</span>           
<span class='line'>577</span>         </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.BRANCH_CLOSED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>578</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">set</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">del.expand</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">del.expand</span><span class="PUNC">(</span><span class="NAME">set</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>579</span>           </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'disclosureState'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SC.BRANCH_OPEN</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>580</span>           </span><span class="NAME">this.displayDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>581</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>582</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>583</span>      
<span class='line'>584</span>       </span><span class="NAME">this._removeDisclosureActiveState</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>585</span>       </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>586</span>     </span><span class="COMM">// if mouse was down in right icon -- then handle mouse up, otherwise </span><span class="WHIT">
<span class='line'>587</span>     </span><span class="COMM">// allow parent view to handle event.</span><span class="WHIT">
<span class='line'>588</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._isMouseDownOnRightIcon</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>589</span>       </span><span class="NAME">this._removeRightIconActiveState</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>590</span>       </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>591</span>     </span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'>592</span>    
<span class='line'>593</span>     </span><span class="COMM">// clear cached info</span><span class="WHIT">
<span class='line'>594</span>     </span><span class="NAME">this._isMouseInsideCheckbox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._isMouseDownOnCheckbox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>595</span>     </span><span class="NAME">this._isMouseDownOnDisclosure</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._isMouseInsideDisclosure</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>596</span>     </span><span class="NAME">this._isMouseInsideRightIcon</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._isMouseDownOnRightIcon</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>597</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>598</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>599</span>   
<span class='line'>600</span>   </span><span class="NAME">mouseMoved</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>601</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._isMouseDownOnCheckbox</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this._isInsideCheckbox</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>602</span>       </span><span class="NAME">this._addCheckboxActiveState</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>603</span>       </span><span class="NAME">this._isMouseInsideCheckbox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>604</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._isMouseDownOnCheckbox</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>605</span>       </span><span class="NAME">this._removeCheckboxActiveState</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>606</span>       </span><span class="NAME">this._isMouseInsideCheckbox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>607</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._isMouseDownOnDisclosure</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this._isInsideDisclosure</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>608</span>       </span><span class="NAME">this._addDisclosureActiveState</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>609</span>       </span><span class="NAME">this._isMouseInsideDisclosure</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>610</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._isMouseDownOnDisclosure</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>611</span>       </span><span class="NAME">this._removeDisclosureActiveState</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>612</span>       </span><span class="NAME">this._isMouseInsideDisclosure</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>613</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._isMouseDownOnRightIcon</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this._isInsideRightIcon</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>614</span>       </span><span class="NAME">this._addRightIconActiveState</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>615</span>       </span><span class="NAME">this._isMouseInsideRightIcon</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>616</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._isMouseDownOnRightIcon</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>617</span>       </span><span class="NAME">this._removeRightIconActiveState</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>618</span>       </span><span class="NAME">this._isMouseInsideRightIcon</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>619</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>620</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>621</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>622</span>   
<span class='line'>623</span>   </span><span class="NAME">touchStart</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>624</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.mouseDown</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>625</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>626</span>   
<span class='line'>627</span>   </span><span class="NAME">touchEnd</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>628</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.mouseUp</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>629</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>630</span>   
<span class='line'>631</span>   </span><span class="NAME">touchEntered</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>632</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.mouseEntered</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>633</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>634</span>   
<span class='line'>635</span>   </span><span class="NAME">touchExited</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>636</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.mouseExited</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>637</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>638</span>   
<span class='line'>639</span>   
<span class='line'>640</span>   </span><span class="NAME">_addCheckboxActiveState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>641</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">enabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEnabled'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>642</span>     </span><span class="NAME">this.$</span><span class="PUNC">(</span><span class="STRN">'.sc-checkbox-view'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setClass</span><span class="PUNC">(</span><span class="STRN">'active'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">enabled</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>643</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>644</span>   
<span class='line'>645</span>   </span><span class="NAME">_removeCheckboxActiveState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>646</span>     </span><span class="NAME">this.$</span><span class="PUNC">(</span><span class="STRN">'.sc-checkbox-view'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">removeClass</span><span class="PUNC">(</span><span class="STRN">'active'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>647</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>648</span> 
<span class='line'>649</span>   </span><span class="NAME">_addDisclosureActiveState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>650</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">enabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEnabled'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>651</span>     </span><span class="NAME">this.$</span><span class="PUNC">(</span><span class="STRN">'img.disclosure'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setClass</span><span class="PUNC">(</span><span class="STRN">'active'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">enabled</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>652</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>653</span>   
<span class='line'>654</span>   </span><span class="NAME">_removeDisclosureActiveState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>655</span>     </span><span class="NAME">this.$</span><span class="PUNC">(</span><span class="STRN">'img.disclosure'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">removeClass</span><span class="PUNC">(</span><span class="STRN">'active'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>656</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>657</span> 
<span class='line'>658</span>   </span><span class="NAME">_addRightIconActiveState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>659</span>     </span><span class="NAME">this.$</span><span class="PUNC">(</span><span class="STRN">'img.right-icon'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setClass</span><span class="PUNC">(</span><span class="STRN">'active'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>660</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>661</span>   
<span class='line'>662</span>   </span><span class="NAME">_removeRightIconActiveState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>663</span>     </span><span class="NAME">this.$</span><span class="PUNC">(</span><span class="STRN">'img.right-icon'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">removeClass</span><span class="PUNC">(</span><span class="STRN">'active'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>664</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>665</span>   
<span class='line'>666</span>   </span><span class="COMM">/**
<span class='line'>667</span>     Returns true if a click is on the label text itself to enable editing.
<span class='line'>668</span>   
<span class='line'>669</span>     Note that if you override renderLabel(), you probably need to override 
<span class='line'>670</span>     this as well, or just $label() if you only want to control the element
<span class='line'>671</span>     returned.
<span class='line'>672</span>   
<span class='line'>673</span>     @param evt {Event} the mouseUp event.
<span class='line'>674</span>     @returns {Boolean} YES if the mouse was on the content element itself.
<span class='line'>675</span>   */</span><span class="WHIT">
<span class='line'>676</span>   </span><span class="NAME">contentHitTest</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>677</span>     </span><span class="COMM">// if not content value is returned, not much to do.</span><span class="WHIT">
<span class='line'>678</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.displayDelegate</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>679</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">labelKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'contentValueKey'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>680</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">labelKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>681</span> 
<span class='line'>682</span>     </span><span class="COMM">// get the element to check for.</span><span class="WHIT">
<span class='line'>683</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.$label</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>684</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// no label to check for.</span><span class="WHIT">
<span class='line'>685</span> 
<span class='line'>686</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'layer'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>687</span>     </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">layer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>688</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>689</span>       </span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cur.parentNode</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>690</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>691</span> 
<span class='line'>692</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>693</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>694</span>   
<span class='line'>695</span>   </span><span class="NAME">beginEditing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>696</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEditing'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>697</span>     </span><span class="COMM">//if (!this.get('contentIsEditable')) return NO ;</span><span class="WHIT">
<span class='line'>698</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._beginEditing</span><span class="PUNC">(</span><span class="NAME">YES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>699</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>700</span>   
<span class='line'>701</span>   </span><span class="NAME">_beginEditing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">scrollIfNeeded</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>702</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>703</span>         </span><span class="NAME">del</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'displayDelegate'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>704</span>         </span><span class="NAME">labelKey</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'contentValueKey'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>705</span>         </span><span class="NAME">parent</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'parentView'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>706</span>         </span><span class="NAME">pf</span><span class="WHIT">        </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">parent.get</span><span class="PUNC">(</span><span class="STRN">'frame'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>707</span>         </span><span class="NAME">el</span><span class="WHIT">        </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.$label</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>708</span>         </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'validator'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>709</span>         </span><span class="NAME">f</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oldLineHeight</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fontSize</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineHeight</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">escapeHTML</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>710</span>         </span><span class="NAME">lineHeightShift</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetLineHeight</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>711</span> 
<span class='line'>712</span>     </span><span class="COMM">// if possible, find a nearby scroll view and scroll into view.</span><span class="WHIT">
<span class='line'>713</span>     </span><span class="COMM">// HACK: if we scrolled, then wait for a loop and get the item view again</span><span class="WHIT">
<span class='line'>714</span>     </span><span class="COMM">// and begin editing.  Right now collection view will regenerate the item</span><span class="WHIT">
<span class='line'>715</span>     </span><span class="COMM">// view too often.</span><span class="WHIT">
<span class='line'>716</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">scrollIfNeeded</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.scrollToVisible</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>717</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">collectionView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'owner'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'contentIndex'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>718</span>       </span><span class="NAME">this.invokeLast</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>719</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">collectionView.itemViewForContentIndex</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>720</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">item._beginEditing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">item._beginEditing</span><span class="PUNC">(</span><span class="NAME">NO</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>721</span>       </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>722</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// let the scroll happen then begin editing...</span><span class="WHIT">
<span class='line'>723</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>724</span>     
<span class='line'>725</span>     </span><span class="COMM">// nothing to do...    </span><span class="WHIT">
<span class='line'>726</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">el.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>727</span>     </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">labelKey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">labelKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>728</span>     
<span class='line'>729</span>     </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.computeFrameWithParentFrame</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>730</span>     </span><span class="NAME">offset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.viewportOffset</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>731</span>     
<span class='line'>732</span>     </span><span class="COMM">// if the label has a large line height, try to adjust it to something</span><span class="WHIT">
<span class='line'>733</span>     </span><span class="COMM">// more reasonable so that it looks right when we show the popup editor.</span><span class="WHIT">
<span class='line'>734</span>     </span><span class="NAME">oldLineHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.css</span><span class="PUNC">(</span><span class="STRN">'lineHeight'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>735</span>     </span><span class="NAME">fontSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.css</span><span class="PUNC">(</span><span class="STRN">'fontSize'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>736</span>     </span><span class="NAME">top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.$</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">css</span><span class="PUNC">(</span><span class="STRN">'top'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>737</span> 
<span class='line'>738</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">top.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">top.length</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>739</span>     </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>740</span> 
<span class='line'>741</span>     </span><span class="NAME">lineHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oldLineHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>742</span>     </span><span class="NAME">lineHeightShift</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>743</span> 
<span class='line'>744</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fontSize</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">lineHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>745</span>       </span><span class="NAME">targetLineHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fontSize</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>746</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetLineHeight</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">lineHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>747</span>         </span><span class="NAME">el.css</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">lineHeight</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'1.5'</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>748</span>         </span><span class="NAME">lineHeightShift</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lineHeight</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">targetLineHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>749</span>       </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">oldLineHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>750</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>751</span> 
<span class='line'>752</span>     </span><span class="NAME">f.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offset.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>753</span>     </span><span class="NAME">f.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offset.y</span><span class="PUNC">+</span><span class="NAME">top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">lineHeightShift</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>754</span>     </span><span class="NAME">f.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">offsetHeight</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>755</span>     </span><span class="NAME">f.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">offsetWidth</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>756</span> 
<span class='line'>757</span>     </span><span class="NAME">escapeHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'escapeHTML'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>758</span> 
<span class='line'>759</span>     </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.InlineTextFieldView.beginEditing</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>760</span>       </span><span class="NAME">frame</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>761</span>       </span><span class="NAME">exampleElement</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>762</span>       </span><span class="NAME">delegate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>763</span>       </span><span class="NAME">value</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>764</span>       </span><span class="NAME">multiline</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>765</span>       </span><span class="NAME">isCollection</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>766</span>       </span><span class="NAME">validator</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">validator</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>767</span>       </span><span class="NAME">escapeHTML</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">escapeHTML</span><span class="WHIT">
<span class='line'>768</span>     </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>769</span> 
<span class='line'>770</span>     </span><span class="COMM">// restore old line height for original item if the old line height </span><span class="WHIT">
<span class='line'>771</span>     </span><span class="COMM">// was saved.</span><span class="WHIT">
<span class='line'>772</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">oldLineHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">el.css</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">lineHeight</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">oldLineHeight</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>773</span> 
<span class='line'>774</span>     </span><span class="COMM">// Done!  If this failed, then set editing back to no.</span><span class="WHIT">
<span class='line'>775</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>776</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>777</span>   
<span class='line'>778</span>   </span><span class="NAME">commitEditing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>779</span>    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEditing'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>780</span>    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">SC.InlineTextFieldView.commitEditing</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>781</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>782</span>   
<span class='line'>783</span>   </span><span class="NAME">discardEditing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>784</span>    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEditing'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>785</span>    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">SC.InlineTextFieldView.discardEditing</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>786</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>787</span>   
<span class='line'>788</span>   </span><span class="COMM">/** @private
<span class='line'>789</span>    Set editing to true so edits will no longer be allowed.
<span class='line'>790</span>   */</span><span class="WHIT">
<span class='line'>791</span>   </span><span class="NAME">inlineEditorWillBeginEditing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">inlineEditor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>792</span>    </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'isEditing'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>793</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>794</span>   
<span class='line'>795</span>   </span><span class="COMM">/** @private 
<span class='line'>796</span>    Hide the label view while the inline editor covers it.
<span class='line'>797</span>   */</span><span class="WHIT">
<span class='line'>798</span>   </span><span class="NAME">inlineEditorDidBeginEditing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">inlineEditor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>799</span>    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.$label</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>800</span>    </span><span class="NAME">this._oldOpacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.css</span><span class="PUNC">(</span><span class="STRN">'opacity'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>801</span>    </span><span class="NAME">el.css</span><span class="PUNC">(</span><span class="STRN">'opacity'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>802</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>803</span>   
<span class='line'>804</span>   </span><span class="COMM">/** @private
<span class='line'>805</span>    Could check with a validator someday...
<span class='line'>806</span>   */</span><span class="WHIT">
<span class='line'>807</span>   </span><span class="NAME">inlineEditorShouldBeginEditing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">inlineEditor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>808</span>    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>809</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>810</span> 
<span class='line'>811</span>   </span><span class="COMM">/** @private
<span class='line'>812</span>    Could check with a validator someday...
<span class='line'>813</span>   */</span><span class="WHIT">
<span class='line'>814</span>   </span><span class="NAME">inlineEditorShouldBeginEditing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">inlineEditor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">finalValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>815</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>816</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>817</span> 
<span class='line'>818</span>   </span><span class="NAME">inlineEditorShouldEndEditing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">inlineEditor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">finalValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>819</span>    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>820</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>821</span>   
<span class='line'>822</span>   </span><span class="COMM">/** @private
<span class='line'>823</span>    Update the field value and make it visible again.
<span class='line'>824</span>   */</span><span class="WHIT">
<span class='line'>825</span>   </span><span class="NAME">inlineEditorDidEndEditing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">inlineEditor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">finalValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>826</span>     </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'isEditing'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>827</span>     
<span class='line'>828</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>829</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.displayDelegate</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>830</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">labelKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="STRN">'contentValueKey'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">del</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>831</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">labelKey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content.set</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>832</span>      </span><span class="NAME">content.set</span><span class="PUNC">(</span><span class="NAME">labelKey</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">finalValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>833</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>834</span>     </span><span class="NAME">this.displayDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>835</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>836</span>   
<span class='line'>837</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>838</span> </span></pre></body></html>