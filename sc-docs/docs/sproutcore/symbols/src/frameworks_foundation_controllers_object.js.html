<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="COMM">// Project:   SproutCore - JavaScript Application Framework</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="COMM">// Copyright: ©2006-2009 Sprout Systems, Inc. and contributors.</span><span class="WHIT">
<span class='line'>  4</span> </span><span class="COMM">//            Portions ©2008-2009 Apple Inc. All rights reserved.</span><span class="WHIT">
<span class='line'>  5</span> </span><span class="COMM">// License:   Licensed under MIT license (see license.js)</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  7</span> 
<span class='line'>  8</span> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'controllers/controller'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  9</span> 
<span class='line'> 10</span> </span><span class="COMM">/** @class
<span class='line'> 11</span> 
<span class='line'> 12</span>   An ObjectController gives you a simple way to manage the editing state of
<span class='line'> 13</span>   an object.  You can use an ObjectController instance as a "proxy" for your
<span class='line'> 14</span>   model objects.
<span class='line'> 15</span>   
<span class='line'> 16</span>   Any properties you get or set on the object controller, will be passed 
<span class='line'> 17</span>   through to its content object.  This allows you to setup bindings to your
<span class='line'> 18</span>   object controller one time for all of your views and then swap out the 
<span class='line'> 19</span>   content as needed.
<span class='line'> 20</span>   
<span class='line'> 21</span>   h2. Working with Arrays
<span class='line'> 22</span>   
<span class='line'> 23</span>   An ObjectController can accept both arrays and single objects as content.  
<span class='line'> 24</span>   If the content is an array, the ObjectController will do its best to treat 
<span class='line'> 25</span>   the array as a single object.  For example, if you set the content of an
<span class='line'> 26</span>   ObjectController to an array of Contact records and then call:
<span class='line'> 27</span>   
<span class='line'> 28</span>     contactController.get('name');
<span class='line'> 29</span>     
<span class='line'> 30</span>   The controller will check the name property of each Contact in the array.  
<span class='line'> 31</span>   If the value of the property for each Contact is the same, that value will 
<span class='line'> 32</span>   be returned.  If the any values are different, then an array will be 
<span class='line'> 33</span>   returned with the values from each Contact in them. 
<span class='line'> 34</span>   
<span class='line'> 35</span>   Most SproutCore views can work with both arrays and single content, which 
<span class='line'> 36</span>   means that most of the time, you can simply hook up your views and this will
<span class='line'> 37</span>   work.
<span class='line'> 38</span>   
<span class='line'> 39</span>   If you would prefer to make sure that your ObjectController is always 
<span class='line'> 40</span>   working with a single object and you are using bindings, you can always 
<span class='line'> 41</span>   setup your bindings so that they will convert the content to a single object 
<span class='line'> 42</span>   like so:
<span class='line'> 43</span>   
<span class='line'> 44</span>     contentBinding: SC.Binding.Single('MyApp.listController.selection') ;
<span class='line'> 45</span> 
<span class='line'> 46</span>   This will ensure that your content property is always a single object 
<span class='line'> 47</span>   instead of an array.
<span class='line'> 48</span>   
<span class='line'> 49</span>   @extends SC.Controller
<span class='line'> 50</span>   @since SproutCore 1.0
<span class='line'> 51</span> */</span><span class="WHIT">
<span class='line'> 52</span> </span><span class="NAME">SC.ObjectController</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.Controller.extend</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'> 53</span> </span><span class="COMM">/** @scope SC.ObjectController.prototype */</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 54</span> 
<span class='line'> 55</span>   </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'> 56</span>   </span><span class="COMM">// PROPERTIES</span><span class="WHIT">
<span class='line'> 57</span>   </span><span class="COMM">// </span><span class="WHIT">
<span class='line'> 58</span>   
<span class='line'> 59</span>   </span><span class="COMM">/**
<span class='line'> 60</span>     Set to the object you want this controller to manage.  The object should
<span class='line'> 61</span>     usually be a single value; not an array or enumerable.  If you do supply
<span class='line'> 62</span>     an array or enumerable with a single item in it, the ObjectController
<span class='line'> 63</span>     will manage that single item.
<span class='line'> 64</span> 
<span class='line'> 65</span>     Usually your content object should implement the SC.Observable mixin, but
<span class='line'> 66</span>     this is not required.  All SC.Object-based objects support SC.Observable
<span class='line'> 67</span>     
<span class='line'> 68</span>     @property {Object}
<span class='line'> 69</span>   */</span><span class="WHIT">
<span class='line'> 70</span>   </span><span class="NAME">content</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 71</span> 
<span class='line'> 72</span>   </span><span class="COMM">/**
<span class='line'> 73</span>     If YES, then setting the content to an enumerable or an array with more 
<span class='line'> 74</span>     than one item will cause the Controller to attempt to treat the array as
<span class='line'> 75</span>     a single object.  Use of get(), for example, will get every property on
<span class='line'> 76</span>     the enumerable and return it.  set() will set the property on every item
<span class='line'> 77</span>     in the enumerable. 
<span class='line'> 78</span>     
<span class='line'> 79</span>     If NO, then setting content to an enumerable with multiple items will be
<span class='line'> 80</span>     treated like setting a null value.  hasContent will be NO.
<span class='line'> 81</span>     
<span class='line'> 82</span>     @property {Boolean}
<span class='line'> 83</span>   */</span><span class="WHIT">
<span class='line'> 84</span>   </span><span class="NAME">allowsMultipleContent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 85</span> 
<span class='line'> 86</span>   </span><span class="COMM">/**
<span class='line'> 87</span>     Becomes YES whenever this object is managing content.  Usually this means
<span class='line'> 88</span>     the content property contains a single object or an array or enumerable
<span class='line'> 89</span>     with a single item.  Array's or enumerables with multiple items will 
<span class='line'> 90</span>     normally make this property NO unless allowsMultipleContent is YES.
<span class='line'> 91</span>     
<span class='line'> 92</span>     @property {Boolean}
<span class='line'> 93</span>   */</span><span class="WHIT">
<span class='line'> 94</span>   </span><span class="NAME">hasContent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 95</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'observableContent'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 96</span>   </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'observableContent'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 97</span>   
<span class='line'> 98</span>   </span><span class="COMM">/**
<span class='line'> 99</span>     Makes a controller editable or not editable.  The SC.Controller class 
<span class='line'>100</span>     itself does not do anything with this property but subclasses will 
<span class='line'>101</span>     respect it when modifying content.
<span class='line'>102</span>     
<span class='line'>103</span>     @property {Boolean}
<span class='line'>104</span>   */</span><span class="WHIT">
<span class='line'>105</span>   </span><span class="NAME">isEditable</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>106</span>   
<span class='line'>107</span>   </span><span class="COMM">/**
<span class='line'>108</span>     Primarily for internal use.  Normally you should not access this property 
<span class='line'>109</span>     directly.  
<span class='line'>110</span>     
<span class='line'>111</span>     Returns the actual observable object proxied by this controller.  Usually 
<span class='line'>112</span>     this property will mirror the content property.  In some cases - notably 
<span class='line'>113</span>     when setting content to an enumerable, this may return a different object.
<span class='line'>114</span>     
<span class='line'>115</span>     Note that if you set the content to an enumerable which itself contains
<span class='line'>116</span>     enumerables and allowsMultipleContent is NO, this will become null.
<span class='line'>117</span>     
<span class='line'>118</span>     @property {Object}
<span class='line'>119</span>   */</span><span class="WHIT">
<span class='line'>120</span>   </span><span class="NAME">observableContent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>121</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>122</span>         </span><span class="NAME">len</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">allowsMultiple</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>123</span>         
<span class='line'>124</span>     </span><span class="COMM">// if enumerable, extract the first item or possibly become null</span><span class="WHIT">
<span class='line'>125</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content.isEnumerable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>126</span>       </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>127</span>       </span><span class="NAME">allowsMultiple</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'allowsMultipleContent'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>128</span>       
<span class='line'>129</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.firstObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>130</span>       </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">len</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">allowsMultiple</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>131</span>       
<span class='line'>132</span>       </span><span class="COMM">// if we got some new content, it better not be enum also...</span><span class="WHIT">
<span class='line'>133</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">allowsMultiple</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content.isEnumerable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>134</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>135</span>     
<span class='line'>136</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>137</span>   </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'allowsMultipleContent'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cacheable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>138</span> 
<span class='line'>139</span>   </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>140</span>   </span><span class="COMM">// METHODS</span><span class="WHIT">
<span class='line'>141</span>   </span><span class="COMM">// </span><span class="WHIT">
<span class='line'>142</span> 
<span class='line'>143</span>   </span><span class="COMM">/**
<span class='line'>144</span>     Override this method to destroy the selected object.
<span class='line'>145</span>     
<span class='line'>146</span>     The default just passes this call onto the content object if it supports
<span class='line'>147</span>     it, and then sets the content to null.  
<span class='line'>148</span>     
<span class='line'>149</span>     Unlike most calls to destroy() this will not actually destroy the 
<span class='line'>150</span>     controller itself; only the the content.  You continue to use the 
<span class='line'>151</span>     controller by setting the content to a new value.
<span class='line'>152</span>     
<span class='line'>153</span>     @returns {SC.ObjectController} receiver
<span class='line'>154</span>   */</span><span class="WHIT">
<span class='line'>155</span>   </span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>156</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'observableContent'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>157</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">content.destroy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.T_FUNCTION</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>158</span>       </span><span class="NAME">content.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>159</span>     </span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'>160</span>     </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">  
<span class='line'>161</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>162</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>163</span>   
<span class='line'>164</span>   </span><span class="COMM">/**
<span class='line'>165</span>     Invoked whenever any property on the content object changes.  
<span class='line'>166</span> 
<span class='line'>167</span>     The default implementation will simply notify any observers that the 
<span class='line'>168</span>     property has changed.  You can override this method if you need to do 
<span class='line'>169</span>     some custom work when the content property changes.
<span class='line'>170</span>     
<span class='line'>171</span>     If you have set the content property to an enumerable with multiple 
<span class='line'>172</span>     objects and you set allowsMultipleContent to YES, this method will be 
<span class='line'>173</span>     called anytime any property in the set changes.
<span class='line'>174</span> 
<span class='line'>175</span>     If all properties have changed on the content or if the content itself 
<span class='line'>176</span>     has changed, this method will be called with a key of "*".
<span class='line'>177</span>     
<span class='line'>178</span>     @param {Object} target the content object
<span class='line'>179</span>     @param {String} key the property that changes
<span class='line'>180</span>     @returns {void}
<span class='line'>181</span>   */</span><span class="WHIT">
<span class='line'>182</span>   </span><span class="NAME">contentPropertyDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>183</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'*'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.allPropertiesDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>184</span>     </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.notifyPropertyChange</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>185</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>186</span>   
<span class='line'>187</span>   </span><span class="COMM">/**
<span class='line'>188</span>     Called whenver you try to get/set an unknown property.  The default 
<span class='line'>189</span>     implementation will pass through to the underlying content object but 
<span class='line'>190</span>     you can override this method to do some other kind of processing if 
<span class='line'>191</span>     needed.
<span class='line'>192</span>     
<span class='line'>193</span>     @property {String} key key being retrieved
<span class='line'>194</span>     @property {Object} value value to set or undefined if reading only
<span class='line'>195</span>     @returns {Object} property value
<span class='line'>196</span>   */</span><span class="WHIT">
<span class='line'>197</span>   </span><span class="NAME">unknownProperty</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>198</span>     
<span class='line'>199</span>     </span><span class="COMM">// avoid circular references</span><span class="WHIT">
<span class='line'>200</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">===</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>201</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>202</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.content</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>203</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>204</span>     
<span class='line'>205</span>     </span><span class="COMM">// for all other keys, just pass through to the observable object if </span><span class="WHIT">
<span class='line'>206</span>     </span><span class="COMM">// there is one.  Use getEach() and setEach() on enumerable objects.</span><span class="WHIT">
<span class='line'>207</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'observableContent'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cur</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isSame</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>208</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">===</span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// empty</span><span class="WHIT">
<span class='line'>209</span> 
<span class='line'>210</span>     </span><span class="COMM">// getter...</span><span class="WHIT">
<span class='line'>211</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>212</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content.isEnumerable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>213</span>         </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content.getEach</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>214</span> 
<span class='line'>215</span>         </span><span class="COMM">// iterate over array to see if all values are the same. if so, then</span><span class="WHIT">
<span class='line'>216</span>         </span><span class="COMM">// just return that value</span><span class="WHIT">
<span class='line'>217</span>         </span><span class="NAME">loc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value.get</span><span class="PUNC">(</span><span class="STRN">'length'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>218</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loc</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>219</span>           </span><span class="NAME">isSame</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>220</span>           </span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value.objectAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>221</span>           </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">--</span><span class="NAME">loc</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">isSame</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>222</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">value.objectAt</span><span class="PUNC">(</span><span class="NAME">loc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">isSame</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>223</span>           </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>224</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isSame</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cur</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>225</span>         </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// empty array.</span><span class="WHIT">
<span class='line'>226</span> 
<span class='line'>227</span>       </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content.isObservable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>228</span>       
<span class='line'>229</span>     </span><span class="COMM">// setter</span><span class="WHIT">
<span class='line'>230</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>231</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEditable'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>232</span>         </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"%@.%@ is not editable"</span><span class="PUNC">.</span><span class="NAME">fmt</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>233</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>234</span>       
<span class='line'>235</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content.isEnumerable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">content.setEach</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>236</span>       </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content.isObservable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">content.set</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>237</span>       </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>238</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>239</span>     
<span class='line'>240</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>241</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>242</span>   
<span class='line'>243</span>   </span><span class="COMM">// ...............................</span><span class="WHIT">
<span class='line'>244</span>   </span><span class="COMM">// INTERNAL SUPPORT</span><span class="WHIT">
<span class='line'>245</span>   </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>246</span> 
<span class='line'>247</span>   </span><span class="COMM">/** @private - setup observer on init if needed. */</span><span class="WHIT">
<span class='line'>248</span>   </span><span class="NAME">init</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>249</span>     </span><span class="NAME">sc_super</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>250</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._scoc_contentDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>251</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'observableContent'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._scoc_observableContentDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>252</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>253</span> 
<span class='line'>254</span>   </span><span class="NAME">_scoc_contentDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>255</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._scoc_content</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>256</span>         </span><span class="NAME">cur</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>257</span>         
<span class='line'>258</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">cur</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>259</span>       </span><span class="NAME">this._scoc_content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cur</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>260</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">func</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._scoc_enumerableContentDidChange</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>261</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">last.isEnumerable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>262</span>         </span><span class="COMM">//console.log('no longer observing [] on last');</span><span class="WHIT">
<span class='line'>263</span>         </span><span class="NAME">last.removeObserver</span><span class="PUNC">(</span><span class="STRN">'[]'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>264</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>265</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">cur.isEnumerable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>266</span>         </span><span class="COMM">//console.log('observing [] on cur');</span><span class="WHIT">
<span class='line'>267</span>         </span><span class="NAME">cur.addObserver</span><span class="PUNC">(</span><span class="STRN">'[]'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>268</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>269</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>270</span>   </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">observes</span><span class="PUNC">(</span><span class="STRN">"content"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>271</span>   
<span class='line'>272</span>   </span><span class="COMM">/**  @private
<span class='line'>273</span>     
<span class='line'>274</span>     Called whenever the observable content property changes.  This will setup
<span class='line'>275</span>     observers on the content if needed.
<span class='line'>276</span>   */</span><span class="WHIT">
<span class='line'>277</span>   </span><span class="NAME">_scoc_observableContentDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>278</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._scoc_observableContent</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>279</span>         </span><span class="NAME">cur</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'observableContent'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>280</span>         </span><span class="NAME">func</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.contentPropertyDidChange</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>281</span>         </span><span class="NAME">efunc</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._scoc_enumerableContentDidChange</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>282</span> 
<span class='line'>283</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">cur</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// nothing to do</span><span class="WHIT">
<span class='line'>284</span>     </span><span class="COMM">//console.log('observableContentDidChange');</span><span class="WHIT">
<span class='line'>285</span>     
<span class='line'>286</span>     </span><span class="NAME">this._scoc_observableContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cur</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// save old content</span><span class="WHIT">
<span class='line'>287</span>     
<span class='line'>288</span>     </span><span class="COMM">// stop observing last item -- if enumerable stop observing set</span><span class="WHIT">
<span class='line'>289</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">last</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>290</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">last.isEnumerable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">last.removeObserver</span><span class="PUNC">(</span><span class="STRN">'[]'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">efunc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>291</span>       </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">last.isObservable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">last.removeObserver</span><span class="PUNC">(</span><span class="STRN">'*'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>292</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>293</span>     
<span class='line'>294</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cur</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>295</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cur.isEnumerable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">cur.addObserver</span><span class="PUNC">(</span><span class="STRN">'[]'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">efunc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>296</span>       </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cur.isObservable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">cur.addObserver</span><span class="PUNC">(</span><span class="STRN">'*'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>297</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>298</span> 
<span class='line'>299</span>     </span><span class="COMM">// notify!</span><span class="WHIT">
<span class='line'>300</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">last.isEnumerable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">cur.isEnumerable</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>301</span>       </span><span class="NAME">this._scoc_enumerableContentDidChange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>302</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.contentPropertyDidChange</span><span class="PUNC">(</span><span class="NAME">cur</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'*'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>303</span> 
<span class='line'>304</span>   </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">observes</span><span class="PUNC">(</span><span class="STRN">"observableContent"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>305</span>   
<span class='line'>306</span>   </span><span class="COMM">/** @private
<span class='line'>307</span>     Called when observed enumerable content has changed.  This will teardown
<span class='line'>308</span>     and setup observers on the enumerable content items and then calls 
<span class='line'>309</span>     contentPropertyDidChange().  This method may be called even if the new
<span class='line'>310</span>     'cur' is not enumerable but the last content was enumerable.
<span class='line'>311</span>   */</span><span class="WHIT">
<span class='line'>312</span>   </span><span class="NAME">_scoc_enumerableContentDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>313</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cur</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'observableContent'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>314</span>         </span><span class="NAME">set</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._scoc_observableContentItems</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>315</span>         </span><span class="NAME">func</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.contentPropertyDidChange</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>316</span>     
<span class='line'>317</span>     </span><span class="COMM">// stop observing each old item</span><span class="WHIT">
<span class='line'>318</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">set</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>319</span>       </span><span class="NAME">set.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>320</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item.isObservable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">item.removeObserver</span><span class="PUNC">(</span><span class="STRN">'*'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>321</span>       </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>322</span>       </span><span class="NAME">set.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>323</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>324</span>     
<span class='line'>325</span>     </span><span class="COMM">// start observing new items if needed</span><span class="WHIT">
<span class='line'>326</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">cur.isEnumerable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>327</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">set</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">set</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.Set.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>328</span>       </span><span class="NAME">cur.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>329</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">set.contains</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// nothing to do</span><span class="WHIT">
<span class='line'>330</span>         </span><span class="NAME">set.add</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>331</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item.isObservable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">item.addObserver</span><span class="PUNC">(</span><span class="STRN">'*'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>332</span>       </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>333</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">set</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>334</span>     
<span class='line'>335</span>     </span><span class="NAME">this._scoc_observableContentItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">set</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// save for later cleanup</span><span class="WHIT">
<span class='line'>336</span>   
<span class='line'>337</span>     </span><span class="COMM">// notify</span><span class="WHIT">
<span class='line'>338</span>     </span><span class="NAME">this.contentPropertyDidChange</span><span class="PUNC">(</span><span class="NAME">cur</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'*'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>339</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>340</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>341</span>         
<span class='line'>342</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>343</span> </span></pre></body></html>