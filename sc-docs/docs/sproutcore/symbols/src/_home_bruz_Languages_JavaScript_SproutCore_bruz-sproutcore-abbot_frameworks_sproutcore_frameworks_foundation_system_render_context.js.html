<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="COMM">// Project:   SproutCore - JavaScript Application Framework</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="COMM">// Copyright: ©2006-2009 Sprout Systems, Inc. and contributors.</span><span class="WHIT">
<span class='line'>  4</span> </span><span class="COMM">//            Portions ©2008-2009 Apple Inc. All rights reserved.</span><span class="WHIT">
<span class='line'>  5</span> </span><span class="COMM">// License:   Licensed under MIT license (see license.js)</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  7</span> 
<span class='line'>  8</span> </span><span class="NAME">sc_require</span><span class="PUNC">(</span><span class="STRN">'system/builder'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  9</span> 
<span class='line'> 10</span> </span><span class="COMM">/** set update mode on context to replace content (preferred) */</span><span class="WHIT">
<span class='line'> 11</span> </span><span class="NAME">SC.MODE_REPLACE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'replace'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 12</span> 
<span class='line'> 13</span> </span><span class="COMM">/** set update mode on context to append content */</span><span class="WHIT">
<span class='line'> 14</span> </span><span class="NAME">SC.MODE_APPEND</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'append'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 15</span> 
<span class='line'> 16</span> </span><span class="COMM">/** set update mode on context to prepend content */</span><span class="WHIT">
<span class='line'> 17</span> </span><span class="NAME">SC.MODE_PREPEND</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'prepend'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 18</span> 
<span class='line'> 19</span> </span><span class="COMM">/**
<span class='line'> 20</span>   @namespace
<span class='line'> 21</span>   
<span class='line'> 22</span>   A RenderContext is a builder that can be used to generate HTML for views or
<span class='line'> 23</span>   to update an existing element.  Rather than making changes to an element
<span class='line'> 24</span>   directly, you use a RenderContext to queue up changes to the element, 
<span class='line'> 25</span>   finally applying those changes or rendering the new element when you are
<span class='line'> 26</span>   finished.
<span class='line'> 27</span>   
<span class='line'> 28</span>   You will not usually create a render context yourself but you will be passed
<span class='line'> 29</span>   a render context as the first parameter of your render() method on custom
<span class='line'> 30</span>   views.
<span class='line'> 31</span>   
<span class='line'> 32</span>   Render contexts are essentially arrays of strings.  You can add a string to
<span class='line'> 33</span>   the context by calling push().  You can retrieve the entire array as a 
<span class='line'> 34</span>   single string using join().  This is basically the way the context is used 
<span class='line'> 35</span>   for views.  You are passed a render context and expected to add strings of
<span class='line'> 36</span>   HTML to the context like a normal array.  Later, the context will be joined
<span class='line'> 37</span>   into a single string and converted into real HTML for display on screen.
<span class='line'> 38</span>   
<span class='line'> 39</span>   In addition to the core push and join methods, the render context also 
<span class='line'> 40</span>   supports some extra methods that make it easy to build tags.  
<span class='line'> 41</span>   
<span class='line'> 42</span>   context.begin() &lt;-- begins a new tag context
<span class='line'> 43</span>   context.end() &lt;-- ends the tag context...
<span class='line'> 44</span> */</span><span class="WHIT">
<span class='line'> 45</span> </span><span class="NAME">SC.RenderContext</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.Builder.create</span><span class="PUNC">(</span><span class="COMM">/** SC.RenderContext.fn */</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 46</span>   
<span class='line'> 47</span>   </span><span class="NAME">SELF_CLOSING</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.CoreSet.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addEach</span><span class="PUNC">(</span><span class="STRN">'area base basefront br hr input img link meta'</span><span class="PUNC">.</span><span class="NAME">w</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 48</span>   
<span class='line'> 49</span>   </span><span class="COMM">/** 
<span class='line'> 50</span>     When you create a context you should pass either a tag name or an element
<span class='line'> 51</span>     that should be used as the basis for building the context.  If you pass
<span class='line'> 52</span>     an element, then the element will be inspected for class names, styles
<span class='line'> 53</span>     and other attributes.  You can also call update() or replace() to 
<span class='line'> 54</span>     modify the element with you context contents.
<span class='line'> 55</span>     
<span class='line'> 56</span>     If you do not pass any parameters, then we assume the tag name is 'div'.
<span class='line'> 57</span>     
<span class='line'> 58</span>     A second parameter, parentContext, is used internally for chaining.  You
<span class='line'> 59</span>     should never pass a second argument.
<span class='line'> 60</span>     
<span class='line'> 61</span>     @param {String|DOMElement} tagNameOrElement 
<span class='line'> 62</span>     @returns {SC.RenderContext} receiver
<span class='line'> 63</span>   */</span><span class="WHIT">
<span class='line'> 64</span>   </span><span class="NAME">init</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tagNameOrElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prevContext</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 65</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">strings</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tagNameOrElementIsString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 66</span>     
<span class='line'> 67</span>     </span><span class="COMM">// if a prevContext was passed, setup with that first...</span><span class="WHIT">
<span class='line'> 68</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">prevContext</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 69</span>       </span><span class="NAME">this.prevObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prevContext</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 70</span>       </span><span class="NAME">this.strings</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prevContext.strings</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 71</span>       </span><span class="NAME">this.offset</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prevContext.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">prevContext.offset</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 72</span>     </span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'> 73</span> 
<span class='line'> 74</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.strings</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.strings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 75</span> 
<span class='line'> 76</span>     </span><span class="COMM">// if tagName is string, just setup for rendering new tagName</span><span class="WHIT">
<span class='line'> 77</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tagNameOrElement</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 78</span>       </span><span class="NAME">tagNameOrElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'div'</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 79</span>       </span><span class="NAME">tagNameOrElementIsString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 80</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 81</span>     </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tagNameOrElement</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'div'</span><span class="WHIT">  </span><span class="PUNC">||</span><span class="WHIT">  </span><span class="NAME">tagNameOrElement</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'label'</span><span class="WHIT">  </span><span class="PUNC">||</span><span class="WHIT">  </span><span class="NAME">tagNameOrElement</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'a'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 82</span>       </span><span class="COMM">// Fast path for common tags.</span><span class="WHIT">
<span class='line'> 83</span>       </span><span class="NAME">tagNameOrElementIsString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 84</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 85</span>     </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">tagNameOrElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.T_STRING</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 86</span>       </span><span class="NAME">tagNameOrElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tagNameOrElement.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 87</span>       </span><span class="NAME">tagNameOrElementIsString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 88</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 89</span>     
<span class='line'> 90</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tagNameOrElementIsString</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 91</span>       </span><span class="NAME">this._tagName</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tagNameOrElement</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 92</span>       </span><span class="NAME">this._needsTag</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// used to determine if end() needs to wrap tag</span><span class="WHIT">
<span class='line'> 93</span>       </span><span class="NAME">this.needsContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 94</span>       
<span class='line'> 95</span>       </span><span class="COMM">// increase length of all contexts to leave space for opening tag</span><span class="WHIT">
<span class='line'> 96</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 97</span>       </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">c.length</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c.prevObject</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 98</span>       
<span class='line'> 99</span>       </span><span class="NAME">this.strings.push</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>100</span>       </span><span class="NAME">this._selfClosing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.SELF_CLOSING.contains</span><span class="PUNC">(</span><span class="NAME">tagNameOrElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>101</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>102</span>     </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>103</span>       </span><span class="NAME">this._elem</span><span class="WHIT">        </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tagNameOrElement</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>104</span>       </span><span class="NAME">this._needsTag</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>105</span>       </span><span class="NAME">this.length</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>106</span>       </span><span class="NAME">this.needsContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>107</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>108</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>109</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>110</span>   
<span class='line'>111</span>   </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>112</span>   </span><span class="COMM">// PROPERTIES</span><span class="WHIT">
<span class='line'>113</span>   </span><span class="COMM">// </span><span class="WHIT">
<span class='line'>114</span>   
<span class='line'>115</span>   </span><span class="COMM">// NOTE: We store this as an actual array of strings so that browsers that</span><span class="WHIT">
<span class='line'>116</span>   </span><span class="COMM">// support dense arrays will use them.</span><span class="WHIT">
<span class='line'>117</span>   </span><span class="COMM">/** 
<span class='line'>118</span>     The current working array of strings.
<span class='line'>119</span>     
<span class='line'>120</span>     @property {Array}
<span class='line'>121</span>   */</span><span class="WHIT">
<span class='line'>122</span>   </span><span class="NAME">strings</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>123</span>   
<span class='line'>124</span>   </span><span class="COMM">/** 
<span class='line'>125</span>     this initial offset into the strings array where this context instance
<span class='line'>126</span>     has its opening tag.
<span class='line'>127</span>     
<span class='line'>128</span>     @property {Number}
<span class='line'>129</span>   */</span><span class="WHIT">
<span class='line'>130</span>   </span><span class="NAME">offset</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>131</span>   
<span class='line'>132</span>   </span><span class="COMM">/**  
<span class='line'>133</span>     the current number of strings owned by the context, including the opening
<span class='line'>134</span>     tag.
<span class='line'>135</span>     
<span class='line'>136</span>     @property {Number}
<span class='line'>137</span>   */</span><span class="WHIT">
<span class='line'>138</span>   </span><span class="NAME">length</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>139</span>   
<span class='line'>140</span>   </span><span class="COMM">/**
<span class='line'>141</span>     Specify the method that should be used to update content on the element.
<span class='line'>142</span>     In almost all cases you want to replace the content.  Very carefully 
<span class='line'>143</span>     managed code (such as in CollectionView) can append or prepend content
<span class='line'>144</span>     instead.
<span class='line'>145</span>     
<span class='line'>146</span>     You probably do not want to change this propery unless you know what you
<span class='line'>147</span>     are doing.
<span class='line'>148</span>     
<span class='line'>149</span>     @property {String}
<span class='line'>150</span>   */</span><span class="WHIT">
<span class='line'>151</span>   </span><span class="NAME">updateMode</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">SC.MODE_REPLACE</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>152</span> 
<span class='line'>153</span>   </span><span class="COMM">/**
<span class='line'>154</span>     YES if the context needs its content filled in, not just its outer 
<span class='line'>155</span>     attributes edited.  This will be set to YES anytime you push strings into
<span class='line'>156</span>     the context or if you don't create it with an element to start with.
<span class='line'>157</span>   */</span><span class="WHIT">
<span class='line'>158</span>   </span><span class="NAME">needsContent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>159</span>   
<span class='line'>160</span>   </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>161</span>   </span><span class="COMM">// CORE STRING API</span><span class="WHIT">
<span class='line'>162</span>   </span><span class="COMM">// </span><span class="WHIT">
<span class='line'>163</span>   
<span class='line'>164</span>   </span><span class="COMM">/**
<span class='line'>165</span>     Returns the string at the designated index.  If you do not pass anything
<span class='line'>166</span>     returns the string array.  This index is an offset from the start of the
<span class='line'>167</span>     strings owned by this context.
<span class='line'>168</span>     
<span class='line'>169</span>     @param {Number} idx the index
<span class='line'>170</span>     @returns {String|Array}
<span class='line'>171</span>   */</span><span class="WHIT">
<span class='line'>172</span>   </span><span class="NAME">get</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>173</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">strings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.strings</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>174</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">strings.slice</span><span class="PUNC">(</span><span class="NAME">this.offset</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">strings</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">+</span><span class="NAME">this.offset</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>175</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>176</span>   
<span class='line'>177</span>   </span><span class="COMM">/**
<span class='line'>178</span>     Adds a string to the render context for later joining.  Note that you can
<span class='line'>179</span>     pass multiple arguments to this method and each item will be pushed.
<span class='line'>180</span>     
<span class='line'>181</span>     @param {String} line the liene to add to the string.
<span class='line'>182</span>     @returns {SC.RenderContext} receiver
<span class='line'>183</span>   */</span><span class="WHIT">
<span class='line'>184</span>   </span><span class="NAME">push</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>185</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">strings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.strings</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>186</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">strings</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.strings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">strings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// create array lazily</span><span class="WHIT">
<span class='line'>187</span>     
<span class='line'>188</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>189</span>       </span><span class="NAME">strings.push.apply</span><span class="PUNC">(</span><span class="NAME">strings</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>190</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">strings.push</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>191</span>     
<span class='line'>192</span>     </span><span class="COMM">// adjust string length for context and all parents...</span><span class="WHIT">
<span class='line'>193</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>194</span>     </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">c.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c.prevObject</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>195</span>     
<span class='line'>196</span>     </span><span class="NAME">this.needsContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>197</span>     
<span class='line'>198</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>199</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>200</span>   
<span class='line'>201</span>   </span><span class="COMM">/**
<span class='line'>202</span>     Pushes the passed string onto the array, but first escapes the string
<span class='line'>203</span>     to ensure that no user-entered HTML is processed as HTML.
<span class='line'>204</span>     
<span class='line'>205</span>     @param {String} line one or mroe lines of text to add
<span class='line'>206</span>     @returns {SC.RenderContext} receiver
<span class='line'>207</span>   */</span><span class="WHIT">
<span class='line'>208</span>   </span><span class="NAME">text</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>209</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments.length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>210</span>     </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">idx</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>211</span>       </span><span class="NAME">this.push</span><span class="PUNC">(</span><span class="NAME">SC.RenderContext.escapeHTML</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>212</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>213</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>214</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>215</span>   
<span class='line'>216</span>   </span><span class="COMM">/**
<span class='line'>217</span>     Joins the strings together, returning the result.  But first, this will
<span class='line'>218</span>     end any open tags.
<span class='line'>219</span>     
<span class='line'>220</span>     @param {String} joinChar optional string to use in joins. def empty string
<span class='line'>221</span>     @returns {String} joined string
<span class='line'>222</span>   */</span><span class="WHIT">
<span class='line'>223</span>   </span><span class="NAME">join</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">joinChar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>224</span>     </span><span class="COMM">// generate tag if needed...</span><span class="WHIT">
<span class='line'>225</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._needsTag</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.end</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>226</span>     
<span class='line'>227</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">strings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.strings</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>228</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">strings</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">strings.join</span><span class="PUNC">(</span><span class="NAME">joinChar</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>229</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>230</span>   
<span class='line'>231</span>   </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>232</span>   </span><span class="COMM">// GENERATING</span><span class="WHIT">
<span class='line'>233</span>   </span><span class="COMM">// </span><span class="WHIT">
<span class='line'>234</span>   
<span class='line'>235</span>   </span><span class="COMM">/**
<span class='line'>236</span>     Begins a new render context based on the passed tagName or element.
<span class='line'>237</span>     Generate said context using end().
<span class='line'>238</span>     
<span class='line'>239</span>     @returns {SC.RenderContext} new context
<span class='line'>240</span>   */</span><span class="WHIT">
<span class='line'>241</span>   </span><span class="NAME">begin</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tagNameOrElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>242</span>     </span><span class="COMM">// console.log('%@.begin(%@) called'.fmt(this, tagNameOrElement));</span><span class="WHIT">
<span class='line'>243</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">SC.RenderContext</span><span class="PUNC">(</span><span class="NAME">tagNameOrElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>244</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>245</span>   
<span class='line'>246</span>   </span><span class="COMM">/**
<span class='line'>247</span>     If the current context targets an element, this method returns the 
<span class='line'>248</span>     element.  If the context does not target an element, this method will 
<span class='line'>249</span>     render the context into an offscreen element and return it.
<span class='line'>250</span>     
<span class='line'>251</span>     @returns {DOMElement} the element
<span class='line'>252</span>   */</span><span class="WHIT">
<span class='line'>253</span>   </span><span class="NAME">element</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">  
<span class='line'>254</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._elem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._elem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>255</span> 
<span class='line'>256</span>     </span><span class="COMM">// create factory div if needed</span><span class="WHIT">
<span class='line'>257</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">K</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.RenderContext</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>258</span>         </span><span class="NAME">factory</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">K.factory</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>259</span>         </span><span class="NAME">ret</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">child</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>260</span> 
<span class='line'>261</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">factory</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>262</span>       </span><span class="NAME">factory</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">K.factory</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'div'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>263</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>264</span>     </span><span class="NAME">factory.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.join</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>265</span>     
<span class='line'>266</span>     </span><span class="COMM">// In IE something weird happens when reusing the same element.</span><span class="WHIT">
<span class='line'>267</span>     </span><span class="COMM">// After setting innerHTML, the innerHTML of the element in the previous</span><span class="WHIT">
<span class='line'>268</span>     </span><span class="COMM">// view turns blank.  It seems that there is something weird with their</span><span class="WHIT">
<span class='line'>269</span>     </span><span class="COMM">// garbage  collection algorithm. I tried just removing the nodes after</span><span class="WHIT">
<span class='line'>270</span>     </span><span class="COMM">// keeping a  reference to the first child, but it didn't work.  I ended</span><span class="WHIT">
<span class='line'>271</span>     </span><span class="COMM">// up cloning the first child.</span><span class="WHIT">
<span class='line'>272</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.browser.msie</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>273</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">factory.innerHTML.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>274</span>         </span><span class="NAME">child</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">factory.firstChild.cloneNode</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>275</span>         </span><span class="NAME">factory.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>276</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>277</span>       </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>278</span>         </span><span class="NAME">child</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>279</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>280</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>281</span>     </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>282</span>       </span><span class="COMM">// Faster path (avoiding the unnecessary node clone) for non-IE</span><span class="WHIT">
<span class='line'>283</span>       </span><span class="COMM">// browsers.</span><span class="WHIT">
<span class='line'>284</span>       </span><span class="NAME">child</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">factory.firstChild</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>285</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>286</span> 
<span class='line'>287</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">child</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>288</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>289</span>   
<span class='line'>290</span>   </span><span class="COMM">/**
<span class='line'>291</span>     Removes an element with the passed id in the currently managed element.
<span class='line'>292</span>   */</span><span class="WHIT">
<span class='line'>293</span>   </span><span class="NAME">remove</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>294</span>     </span><span class="COMM">// console.log('remove('+elementId+')');</span><span class="WHIT">
<span class='line'>295</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>296</span>     
<span class='line'>297</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._elem</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>298</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">elem</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">elem.removeChild</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>299</span>     
<span class='line'>300</span>     </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>301</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>302</span>       </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elem.removeChild</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>303</span>       </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>304</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>305</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>306</span>   
<span class='line'>307</span>   </span><span class="COMM">/**
<span class='line'>308</span>     If an element was set on this context when it was created, this method 
<span class='line'>309</span>     will actually apply any changes to the element itself.  If you have not
<span class='line'>310</span>     written any inner html into the context, then the innerHTML of the 
<span class='line'>311</span>     element will not be changed, otherwise it will be replaced with the new
<span class='line'>312</span>     innerHTML.
<span class='line'>313</span>     
<span class='line'>314</span>     Also, any attributes, id, classNames or styles you've set will be 
<span class='line'>315</span>     updated as well.  This also ends the editing context session and cleans
<span class='line'>316</span>     up.
<span class='line'>317</span>     
<span class='line'>318</span>     @returns {SC.RenderContext} previous context or null if top 
<span class='line'>319</span>   */</span><span class="WHIT">
<span class='line'>320</span>   </span><span class="NAME">update</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>321</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._elem</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>322</span>         </span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.updateMode</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>323</span>         </span><span class="NAME">cq</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">styles</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">factory</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cur</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">next</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">before</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>324</span>         
<span class='line'>325</span>     </span><span class="NAME">this._innerHTMLReplaced</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>326</span>     
<span class='line'>327</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">elem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>328</span>       </span><span class="COMM">// throw "Cannot update context because there is no source element";</span><span class="WHIT">
<span class='line'>329</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>330</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>331</span> 
<span class='line'>332</span>     </span><span class="NAME">cq</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.$</span><span class="PUNC">(</span><span class="NAME">elem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>333</span>     
<span class='line'>334</span>     </span><span class="COMM">// console.log('%@#update() called'.fmt(this));</span><span class="WHIT">
<span class='line'>335</span>     </span><span class="COMM">// if (this.length>0) console.log(this.join());</span><span class="WHIT">
<span class='line'>336</span>     </span><span class="COMM">// else console.log('&lt;no length>');</span><span class="WHIT">
<span class='line'>337</span>     
<span class='line'>338</span>     </span><span class="COMM">// replace innerHTML</span><span class="WHIT">
<span class='line'>339</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>340</span>       </span><span class="NAME">this._innerHTMLReplaced</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>341</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.MODE_REPLACE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>342</span>         </span><span class="NAME">elem.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.join</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>343</span>       </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>344</span>         </span><span class="NAME">factory</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elem.cloneNode</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>345</span>         </span><span class="NAME">factory.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.join</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>346</span>         </span><span class="NAME">before</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.MODE_APPEND</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">elem.firstChild</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>347</span>         </span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">factory.firstChild</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>348</span>         </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">cur</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>349</span>           </span><span class="NAME">next</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cur.nextSibling</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>350</span>           </span><span class="NAME">elem.insertBefore</span><span class="PUNC">(</span><span class="NAME">cur</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">next</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>351</span>           </span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">next</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>352</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>353</span>         </span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">next</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">factory</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">before</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// cleanup </span><span class="WHIT">
<span class='line'>354</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>355</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>356</span>     
<span class='line'>357</span>     </span><span class="COMM">// note: each of the items below only apply if the private variable has</span><span class="WHIT">
<span class='line'>358</span>     </span><span class="COMM">// been set to something other than null (indicating they were used at</span><span class="WHIT">
<span class='line'>359</span>     </span><span class="COMM">// some point during the build)</span><span class="WHIT">
<span class='line'>360</span>     
<span class='line'>361</span>     </span><span class="COMM">// if we have attrs, apply them</span><span class="WHIT">
<span class='line'>362</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._attrsDidChange</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._attrs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>363</span>       </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>364</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">value.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>365</span>         </span><span class="NAME">attr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>366</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">attr</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// remove empty attrs</span><span class="WHIT">
<span class='line'>367</span>           </span><span class="NAME">elem.removeAttribute</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>368</span>         </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>369</span>           </span><span class="NAME">cq.attr</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>370</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>371</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>372</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>373</span>     
<span class='line'>374</span>     </span><span class="COMM">// class="foo bar"</span><span class="WHIT">
<span class='line'>375</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._classNamesDidChange</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._classNames</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>376</span>       </span><span class="NAME">cq.attr</span><span class="PUNC">(</span><span class="STRN">'class'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value.join</span><span class="PUNC">(</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>377</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>378</span>     
<span class='line'>379</span>     </span><span class="COMM">// id="foo"</span><span class="WHIT">
<span class='line'>380</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._idDidChange</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>381</span>       </span><span class="NAME">cq.attr</span><span class="PUNC">(</span><span class="STRN">'id'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>382</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>383</span>     
<span class='line'>384</span>     </span><span class="COMM">// style="a:b; c:d;"</span><span class="WHIT">
<span class='line'>385</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._stylesDidChange</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">styles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._styles</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>386</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pair</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._STYLE_PAIR_ARRAY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">joined</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._JOIN_ARRAY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>387</span>       </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">styles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>388</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">styles.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>389</span>         </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">styles</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>390</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// skip empty styles</span><span class="WHIT">
<span class='line'>391</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"zIndex"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>392</span>         </span><span class="NAME">pair</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._dasherizeStyleName</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>393</span>         </span><span class="NAME">pair</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>394</span>         </span><span class="NAME">joined.push</span><span class="PUNC">(</span><span class="NAME">pair.join</span><span class="PUNC">(</span><span class="STRN">': '</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>395</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>396</span>       
<span class='line'>397</span>       </span><span class="NAME">cq.attr</span><span class="PUNC">(</span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">joined.join</span><span class="PUNC">(</span><span class="STRN">'; '</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>398</span>       </span><span class="NAME">joined.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// reset temporary object</span><span class="WHIT">
<span class='line'>399</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>400</span>     
<span class='line'>401</span>     </span><span class="COMM">// now cleanup element...</span><span class="WHIT">
<span class='line'>402</span>     </span><span class="NAME">elem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._elem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>403</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.prevObject</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>404</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>405</span>   
<span class='line'>406</span>   </span><span class="COMM">// these are temporary objects are reused by end() to avoid memory allocs.</span><span class="WHIT">
<span class='line'>407</span>   </span><span class="NAME">_DEFAULT_ATTRS</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>408</span>   </span><span class="NAME">_TAG_ARRAY</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>409</span>   </span><span class="NAME">_JOIN_ARRAY</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>410</span>   </span><span class="NAME">_STYLE_PAIR_ARRAY</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>411</span>   
<span class='line'>412</span>   </span><span class="COMM">/**
<span class='line'>413</span>     Ends the current tag editing context.  This will generate the tag string
<span class='line'>414</span>     including any attributes you might have set along with a closing tag.
<span class='line'>415</span>     
<span class='line'>416</span>     The generated HTML will be added to the render context strings.  This will
<span class='line'>417</span>     also return the previous context if there is one or the receiver.
<span class='line'>418</span>     
<span class='line'>419</span>     If you do not have a current tag, this does nothing.
<span class='line'>420</span>      
<span class='line'>421</span>     @returns {SC.RenderContext} 
<span class='line'>422</span>   */</span><span class="WHIT">
<span class='line'>423</span>   </span><span class="NAME">end</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>424</span>     </span><span class="COMM">// console.log('%@.end() called'.fmt(this));</span><span class="WHIT">
<span class='line'>425</span>     </span><span class="COMM">// NOTE: If you modify this method, be careful to consider memory usage</span><span class="WHIT">
<span class='line'>426</span>     </span><span class="COMM">// and performance here.  This method is called frequently during renders</span><span class="WHIT">
<span class='line'>427</span>     </span><span class="COMM">// and we want it to be as fast as possible.</span><span class="WHIT">
<span class='line'>428</span> 
<span class='line'>429</span>     </span><span class="COMM">// generate opening tag.</span><span class="WHIT">
<span class='line'>430</span>     
<span class='line'>431</span>     </span><span class="COMM">// get attributes first.  Copy in className + styles...</span><span class="WHIT">
<span class='line'>432</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._TAG_ARRAY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pair</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">joined</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>433</span>         </span><span class="NAME">attrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._attrs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._classNames</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>434</span>         </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">styles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._styles</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>435</span>     
<span class='line'>436</span>     </span><span class="COMM">// add tag to tag array</span><span class="WHIT">
<span class='line'>437</span>     </span><span class="NAME">tag</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'&lt;'</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="NAME">tag</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._tagName</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>438</span>     
<span class='line'>439</span>     </span><span class="COMM">// add any attributes...</span><span class="WHIT">
<span class='line'>440</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">attrs</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">className</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">styles</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>441</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._DEFAULT_ATTRS</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>442</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">attrs.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>443</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="STRN">'class'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">className.join</span><span class="PUNC">(</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>444</span>     
<span class='line'>445</span>       </span><span class="COMM">// add in styles.  note how we avoid memory allocs here to keep things </span><span class="WHIT">
<span class='line'>446</span>       </span><span class="COMM">// fast...</span><span class="WHIT">
<span class='line'>447</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">styles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>448</span>         </span><span class="NAME">joined</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._JOIN_ARRAY</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>449</span>         </span><span class="NAME">pair</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._STYLE_PAIR_ARRAY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>450</span>         </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">styles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>451</span>           </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">styles.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>452</span>           </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">styles</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>453</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// skip empty styles</span><span class="WHIT">
<span class='line'>454</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"zIndex"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>455</span> 
<span class='line'>456</span>           </span><span class="NAME">pair</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._dasherizeStyleName</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>457</span>           </span><span class="NAME">pair</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>458</span>           </span><span class="NAME">joined.push</span><span class="PUNC">(</span><span class="NAME">pair.join</span><span class="PUNC">(</span><span class="STRN">': '</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>459</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>460</span>         </span><span class="NAME">attrs.style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">joined.join</span><span class="PUNC">(</span><span class="STRN">'; '</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>461</span>       
<span class='line'>462</span>         </span><span class="COMM">// reset temporary object.  pair does not need to be reset since it </span><span class="WHIT">
<span class='line'>463</span>         </span><span class="COMM">// is always overwritten</span><span class="WHIT">
<span class='line'>464</span>         </span><span class="NAME">joined.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>465</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>466</span>       
<span class='line'>467</span>       </span><span class="COMM">// now convert attrs hash to tag array...</span><span class="WHIT">
<span class='line'>468</span>       </span><span class="NAME">tag.push</span><span class="PUNC">(</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// add space for joining0</span><span class="WHIT">
<span class='line'>469</span>       </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>470</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">attrs.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>471</span>         </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>472</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// skip empty attrs</span><span class="WHIT">
<span class='line'>473</span>         </span><span class="NAME">tag.push</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'="'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'" '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>474</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>475</span>       
<span class='line'>476</span>       </span><span class="COMM">// if we are using the DEFAULT_ATTRS temporary object, make sure we </span><span class="WHIT">
<span class='line'>477</span>       </span><span class="COMM">// reset.</span><span class="WHIT">
<span class='line'>478</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">attrs</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">this._DEFAULT_ATTRS</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>479</span>         </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">attrs.style</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="STRN">'class'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">attrs.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>480</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>481</span>       
<span class='line'>482</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>483</span>     
<span class='line'>484</span>     </span><span class="COMM">// this is self closing if there is no content in between and selfClosing</span><span class="WHIT">
<span class='line'>485</span>     </span><span class="COMM">// is not set to false.</span><span class="WHIT">
<span class='line'>486</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">strings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.strings</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>487</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selfClosing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._selfClosing</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>488</span>     </span><span class="NAME">tag.push</span><span class="PUNC">(</span><span class="NAME">selfClosing</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">' />'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'>'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>489</span>     
<span class='line'>490</span>     </span><span class="COMM">// console.log('selfClosing == %@'.fmt(selfClosing));</span><span class="WHIT">
<span class='line'>491</span>     
<span class='line'>492</span>     </span><span class="NAME">strings</span><span class="PUNC">[</span><span class="NAME">this.offset</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tag.join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>493</span>     </span><span class="NAME">tag.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// reset temporary object</span><span class="WHIT">
<span class='line'>494</span>     
<span class='line'>495</span>     </span><span class="COMM">// now generate closing tag if needed...</span><span class="WHIT">
<span class='line'>496</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">selfClosing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>497</span>       </span><span class="NAME">tag</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'&lt;/'</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>498</span>       </span><span class="NAME">tag</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._tagName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>499</span>       </span><span class="NAME">tag</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'>'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>500</span>       </span><span class="NAME">strings.push</span><span class="PUNC">(</span><span class="NAME">tag.join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>501</span>       
<span class='line'>502</span>       </span><span class="COMM">// increase length of receiver and all parents</span><span class="WHIT">
<span class='line'>503</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>504</span>       </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">c.length</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c.prevObject</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>505</span>       </span><span class="NAME">tag.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// reset temporary object again</span><span class="WHIT">
<span class='line'>506</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>507</span>     
<span class='line'>508</span>     </span><span class="COMM">// if there was a source element, cleanup to avoid memory leaks</span><span class="WHIT">
<span class='line'>509</span>     </span><span class="NAME">this._elem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>510</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.prevObject</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>511</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>512</span>   
<span class='line'>513</span>   </span><span class="COMM">/**
<span class='line'>514</span>     Generates a tag with the passed options.  Like calling context.begin().end().
<span class='line'>515</span>     
<span class='line'>516</span>     @param {String} tagName optional tag name.  default 'div'
<span class='line'>517</span>     @param {Hash} opts optional tag options.  defaults to empty options.
<span class='line'>518</span>     @returns {SC.RenderContext} receiver 
<span class='line'>519</span>   */</span><span class="WHIT">
<span class='line'>520</span>   </span><span class="NAME">tag</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tagName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>521</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.begin</span><span class="PUNC">(</span><span class="NAME">tagName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">end</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>522</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>523</span>     
<span class='line'>524</span>   </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>525</span>   </span><span class="COMM">// BASIC HELPERS</span><span class="WHIT">
<span class='line'>526</span>   </span><span class="COMM">// </span><span class="WHIT">
<span class='line'>527</span>   
<span class='line'>528</span>   </span><span class="COMM">/**
<span class='line'>529</span>     Reads outer tagName if no param is passed, sets tagName otherwise.
<span class='line'>530</span>     
<span class='line'>531</span>     @param {String} tagName pass to set tag name.
<span class='line'>532</span>     @returns {String|SC.RenderContext} tag name or receiver
<span class='line'>533</span>   */</span><span class="WHIT">
<span class='line'>534</span>   </span><span class="NAME">tagName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tagName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>535</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tagName</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>536</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._tagName</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this._elem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._tagName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._elem.tagName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>537</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._tagName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>538</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>539</span>       </span><span class="NAME">this._tagName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tagName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>540</span>       </span><span class="NAME">this._tagNameDidChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>541</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>542</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>543</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>544</span>   
<span class='line'>545</span>   </span><span class="COMM">/**
<span class='line'>546</span>     Reads the outer tag id if no param is passed, sets the id otherwise.
<span class='line'>547</span>     
<span class='line'>548</span>     @param {String} idName the id or set
<span class='line'>549</span>     @returns {String|SC.RenderContext} id or receiver
<span class='line'>550</span>   */</span><span class="WHIT">
<span class='line'>551</span>   </span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">idName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>552</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idName</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>553</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._id</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this._elem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._elem.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>554</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._id</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>555</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>556</span>       </span><span class="NAME">this._id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">idName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>557</span>       </span><span class="NAME">this._idDidChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>558</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>559</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>560</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>561</span>   
<span class='line'>562</span>   </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>563</span>   </span><span class="COMM">// CSS CLASS NAMES SUPPORT</span><span class="WHIT">
<span class='line'>564</span>   </span><span class="COMM">// </span><span class="WHIT">
<span class='line'>565</span>   
<span class='line'>566</span>   </span><span class="COMM">/**
<span class='line'>567</span>     Reads the current classNames array or sets the array if a param is passed.
<span class='line'>568</span>     Note that if you get the classNames array and then modify it, you MUST 
<span class='line'>569</span>     call this method again to set the array or else it may not be copied to
<span class='line'>570</span>     the element.
<span class='line'>571</span> 
<span class='line'>572</span>     If you do pass a classNames array, you can also pass YES for the 
<span class='line'>573</span>     cloneOnModify param.  This will cause the context to clone the class names
<span class='line'>574</span>     before making any further edits.  This is useful is you have a shared 
<span class='line'>575</span>     array of class names you want to start with but edits should not change
<span class='line'>576</span>     the shared array.
<span class='line'>577</span>     
<span class='line'>578</span>     @param {Array} classNames array 
<span class='line'>579</span>     @param {Boolean} cloneOnModify
<span class='line'>580</span>     @returns {Array|SC.RenderContext} classNames array or receiver
<span class='line'>581</span>   */</span><span class="WHIT">
<span class='line'>582</span>   </span><span class="NAME">classNames</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">classNames</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cloneOnModify</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>583</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">classNames</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>584</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._classNames</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this._elem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>585</span>         </span><span class="NAME">this._classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.$</span><span class="PUNC">(</span><span class="NAME">this._elem</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'class'</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>586</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>587</span>       
<span class='line'>588</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._cloneClassNames</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>589</span>         </span><span class="NAME">this._classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._classNames</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>590</span>         </span><span class="NAME">this._cloneClassNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>591</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>592</span> 
<span class='line'>593</span>       </span><span class="COMM">// if there are no class names, create an empty array but don't modify.</span><span class="WHIT">
<span class='line'>594</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._classNames</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>595</span>       
<span class='line'>596</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._classNames</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>597</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>598</span>       </span><span class="NAME">this._classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">classNames</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>599</span>       </span><span class="NAME">this._cloneClassNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cloneOnModify</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>600</span>       </span><span class="NAME">this._classNamesDidChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>601</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>602</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>603</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>604</span>   
<span class='line'>605</span>   </span><span class="COMM">/**
<span class='line'>606</span>     Returns YES if the outer tag current has the passed class name, NO 
<span class='line'>607</span>     otherwise.
<span class='line'>608</span>     
<span class='line'>609</span>     @param {String} className the class name
<span class='line'>610</span>     @returns {Boolean}
<span class='line'>611</span>   */</span><span class="WHIT">
<span class='line'>612</span>   </span><span class="NAME">hasClass</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>613</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.classNames</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">  
<span class='line'>614</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>615</span>   
<span class='line'>616</span>   </span><span class="COMM">/**
<span class='line'>617</span>     Adds the specified className to the current tag, if it does not already
<span class='line'>618</span>     exist.  This method has no effect if there is no open tag.
<span class='line'>619</span>     
<span class='line'>620</span>     @param {String|Array} nameOrClasses the class name or an array of classes
<span class='line'>621</span>     @returns {SC.RenderContext} receiver
<span class='line'>622</span>   */</span><span class="WHIT">
<span class='line'>623</span>   </span><span class="NAME">addClass</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nameOrClasses</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>624</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nameOrClasses</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">nameOrClasses</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>625</span>       </span><span class="NAME">console.warn</span><span class="PUNC">(</span><span class="STRN">'You are adding an undefined or empty class'</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>626</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>627</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>628</span>     
<span class='line'>629</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.classNames</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// handles cloning ,etc.</span><span class="WHIT">
<span class='line'>630</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">SC.typeOf</span><span class="PUNC">(</span><span class="NAME">nameOrClasses</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.T_STRING</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>631</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">classNames.indexOf</span><span class="PUNC">(</span><span class="NAME">nameOrClasses</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>632</span>         </span><span class="NAME">classNames.push</span><span class="PUNC">(</span><span class="NAME">nameOrClasses</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>633</span>         </span><span class="NAME">this._classNamesDidChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>634</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>635</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>636</span>       </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">iLen</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nameOrClasses.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">iLen</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>637</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nameOrClasses</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>638</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">classNames.indexOf</span><span class="PUNC">(</span><span class="NAME">cl</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>639</span>           </span><span class="NAME">classNames.push</span><span class="PUNC">(</span><span class="NAME">cl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>640</span>           </span><span class="NAME">this._classNamesDidChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>641</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>642</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>643</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>644</span>     
<span class='line'>645</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>646</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>647</span>   
<span class='line'>648</span>   </span><span class="COMM">/**
<span class='line'>649</span>     Removes the specified className from the current tag.  This method has 
<span class='line'>650</span>     no effect if there is not an open tag.
<span class='line'>651</span>     
<span class='line'>652</span>     @param {String} className the class to add
<span class='line'>653</span>     @returns {SC.RenderContext} receiver
<span class='line'>654</span>   */</span><span class="WHIT">
<span class='line'>655</span>   </span><span class="NAME">removeClass</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>656</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._classNames</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>657</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">classNames</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this._elem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>658</span>       </span><span class="NAME">classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> 
<span class='line'>659</span>         </span><span class="PUNC">(</span><span class="NAME">SC.$</span><span class="PUNC">(</span><span class="NAME">this._elem</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'class'</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>660</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>661</span> 
<span class='line'>662</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">classNames</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">=</span><span class="NAME">classNames.indexOf</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>663</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._cloneClassNames</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>664</span>         </span><span class="NAME">classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">classNames.slice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>665</span>         </span><span class="NAME">this._cloneClassNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>666</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>667</span> 
<span class='line'>668</span>       </span><span class="COMM">// if className is found, just null it out.  This will end up adding an</span><span class="WHIT">
<span class='line'>669</span>       </span><span class="COMM">// extra space to the generated HTML but it is faster than trying to </span><span class="WHIT">
<span class='line'>670</span>       </span><span class="COMM">// recompact the array.</span><span class="WHIT">
<span class='line'>671</span>       </span><span class="NAME">classNames</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>672</span>       </span><span class="NAME">this._classNamesDidChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>673</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>674</span>     
<span class='line'>675</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>676</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>677</span>   
<span class='line'>678</span>   </span><span class="COMM">/**
<span class='line'>679</span>     Removes all classnames from the currentContext.  
<span class='line'>680</span>     
<span class='line'>681</span>     @returns {SC.RenderContext} receiver
<span class='line'>682</span>   */</span><span class="WHIT">
<span class='line'>683</span>   </span><span class="NAME">resetClassNames</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>684</span>     </span><span class="NAME">this._classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>685</span>     </span><span class="NAME">this._classNamesDidChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>686</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>687</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>688</span>   
<span class='line'>689</span>   </span><span class="COMM">/**
<span class='line'>690</span>     You can either pass a single class name and a boolean indicating whether
<span class='line'>691</span>     the value should be added or removed, or you can pass a hash with all
<span class='line'>692</span>     the class names you want to add or remove with a boolean indicating 
<span class='line'>693</span>     whether they should be there or not.
<span class='line'>694</span>     
<span class='line'>695</span>     This is far more efficient than using addClass/removeClass.
<span class='line'>696</span>     
<span class='line'>697</span>     @param {String|Hash} className class name or hash of classNames + bools
<span class='line'>698</span>     @param {Boolean} shouldAdd for class name if a string was passed
<span class='line'>699</span>     @returns {SC.RenderContext} receiver
<span class='line'>700</span>   */</span><span class="WHIT">
<span class='line'>701</span>   </span><span class="NAME">setClass</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">shouldAdd</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>702</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">classNames</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">didChange</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>703</span>     
<span class='line'>704</span>     </span><span class="COMM">// simple form</span><span class="WHIT">
<span class='line'>705</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">shouldAdd</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>706</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">shouldAdd</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.addClass</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.removeClass</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>707</span>       
<span class='line'>708</span>     </span><span class="COMM">// bulk form</span><span class="WHIT">
<span class='line'>709</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>710</span>       
<span class='line'>711</span>       </span><span class="NAME">classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._classNames</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>712</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">classNames</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this._elem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>713</span>         </span><span class="NAME">classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> 
<span class='line'>714</span>           </span><span class="PUNC">(</span><span class="NAME">SC.$</span><span class="PUNC">(</span><span class="NAME">this._elem</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'class'</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>715</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>716</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">classNames</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>717</span>     
<span class='line'>718</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._cloneClassNames</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>719</span>         </span><span class="NAME">classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._classNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">classNames.slice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>720</span>         </span><span class="NAME">this._cloneClassNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>721</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>722</span> 
<span class='line'>723</span>       </span><span class="NAME">didChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>724</span>       </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">className</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>725</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">className.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>726</span>         </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">classNames.indexOf</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>727</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>728</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">classNames.push</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">didChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>729</span>         </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>730</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">classNames</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">didChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>731</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>732</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>733</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">didChange</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._classNamesDidChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>734</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>735</span>     
<span class='line'>736</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>737</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>738</span>   
<span class='line'>739</span>   </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>740</span>   </span><span class="COMM">// CSS Styles Support</span><span class="WHIT">
<span class='line'>741</span>   </span><span class="COMM">// </span><span class="WHIT">
<span class='line'>742</span>     
<span class='line'>743</span>   </span><span class="NAME">_STYLE_REGEX</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="REGX">/-?\s*([^:\s]+)\s*:\s*([^;]+)\s*;?/g</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>744</span>   
<span class='line'>745</span>   </span><span class="COMM">/**
<span class='line'>746</span>     Retrieves or sets the current styles for the outer tag.  If you retrieve
<span class='line'>747</span>     the styles hash to edit it, you must set the hash again in order for it 
<span class='line'>748</span>     to be applied to the element on rendering.
<span class='line'>749</span>     
<span class='line'>750</span>     Optionally you can also pass YES to the cloneOnModify param to cause the
<span class='line'>751</span>     styles has to be cloned before it is edited.  This is useful if you want
<span class='line'>752</span>     to start with a shared style hash and then optionally modify it for each
<span class='line'>753</span>     context.
<span class='line'>754</span>     
<span class='line'>755</span>     @param {Hash} styles styles hash
<span class='line'>756</span>     @param {Boolean} cloneOnModify
<span class='line'>757</span>     @returns {Hash|SC.RenderContext} styles hash or receiver
<span class='line'>758</span>   */</span><span class="WHIT">
<span class='line'>759</span>   </span><span class="NAME">styles</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">styles</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cloneOnModify</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>760</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">regex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">match</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>761</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">styles</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>762</span>       
<span class='line'>763</span>       </span><span class="COMM">// no styles are defined yet but we do have a source element.  Lazily</span><span class="WHIT">
<span class='line'>764</span>       </span><span class="COMM">// extract styles from element.</span><span class="WHIT">
<span class='line'>765</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._styles</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this._elem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>766</span>         </span><span class="COMM">// parse style...</span><span class="WHIT">
<span class='line'>767</span>         </span><span class="NAME">attr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.$</span><span class="PUNC">(</span><span class="NAME">this._elem</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'style'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>768</span>         
<span class='line'>769</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">attr</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">attr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attr.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>770</span>           </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">SC.browser.msie</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>771</span>             </span><span class="NAME">attr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attr.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>772</span>           </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>773</span>           </span><span class="NAME">styles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>774</span>           
<span class='line'>775</span>           </span><span class="NAME">regex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._STYLE_REGEX</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>776</span>           </span><span class="NAME">regex.lastIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>777</span>           
<span class='line'>778</span>           </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">match</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">regex.exec</span><span class="PUNC">(</span><span class="NAME">attr</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">styles</span><span class="PUNC">[</span><span class="NAME">this._camelizeStyleName</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">match</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>779</span>           
<span class='line'>780</span>           </span><span class="NAME">this._styles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">styles</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>781</span>           </span><span class="NAME">this._cloneStyles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>782</span>           
<span class='line'>783</span>         </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>784</span>           </span><span class="NAME">this._styles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>785</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>786</span>         
<span class='line'>787</span>       </span><span class="COMM">// if there is no element or we do have styles, possibly clone them</span><span class="WHIT">
<span class='line'>788</span>       </span><span class="COMM">// before returning.</span><span class="WHIT">
<span class='line'>789</span>       </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>790</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._styles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>791</span>           </span><span class="NAME">this._styles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>792</span>         </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>793</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._cloneStyles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>794</span>             </span><span class="NAME">this._styles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.beget</span><span class="PUNC">(</span><span class="NAME">this._styles</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>795</span>             </span><span class="NAME">this._cloneStyles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>796</span>           </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>797</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>798</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>799</span>       
<span class='line'>800</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._styles</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>801</span>       
<span class='line'>802</span>     </span><span class="COMM">// set the styles if passed.</span><span class="WHIT">
<span class='line'>803</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>804</span>       </span><span class="NAME">this._styles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">styles</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>805</span>       </span><span class="NAME">this._cloneStyles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cloneOnModify</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>806</span>       </span><span class="NAME">this._stylesDidChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>807</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>808</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>809</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>810</span>   
<span class='line'>811</span>   </span><span class="COMM">/**
<span class='line'>812</span>     Apply the passed styles to the tag.  You can pass either a single key
<span class='line'>813</span>     value pair or a hash of styles.  Note that if you set a style on an 
<span class='line'>814</span>     existing element, it will replace any existing styles on the element.
<span class='line'>815</span>     
<span class='line'>816</span>     @param {String|Hash} nameOrStyles the style name or a hash of styles
<span class='line'>817</span>     @param {String|Number} value style value if string name was passed
<span class='line'>818</span>     @returns {SC.RenderContext} receiver
<span class='line'>819</span>   */</span><span class="WHIT">
<span class='line'>820</span>   </span><span class="NAME">addStyle</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nameOrStyles</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>821</span>     
<span class='line'>822</span>     </span><span class="COMM">// get the current hash of styles.  This will extract the styles and </span><span class="WHIT">
<span class='line'>823</span>     </span><span class="COMM">// clone them if needed.  This will get the actual styles hash so we can</span><span class="WHIT">
<span class='line'>824</span>     </span><span class="COMM">// edit it directly.</span><span class="WHIT">
<span class='line'>825</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">didChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">styles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.styles</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>826</span>     
<span class='line'>827</span>     </span><span class="COMM">// simple form</span><span class="WHIT">
<span class='line'>828</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">nameOrStyles</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.T_STRING</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>829</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// reader</span><span class="WHIT">
<span class='line'>830</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">styles</span><span class="PUNC">[</span><span class="NAME">nameOrStyles</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>831</span>       </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// writer</span><span class="WHIT">
<span class='line'>832</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">styles</span><span class="PUNC">[</span><span class="NAME">nameOrStyles</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>833</span>           </span><span class="NAME">styles</span><span class="PUNC">[</span><span class="NAME">nameOrStyles</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>834</span>           </span><span class="NAME">this._stylesDidChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>835</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>836</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>837</span>       
<span class='line'>838</span>     </span><span class="COMM">// bulk form</span><span class="WHIT">
<span class='line'>839</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>840</span>       </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">nameOrStyles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>841</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nameOrStyles.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>842</span>         </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nameOrStyles</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>843</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">styles</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>844</span>           </span><span class="NAME">styles</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>845</span>           </span><span class="NAME">didChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>846</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>847</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>848</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">didChange</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._stylesDidChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>849</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>850</span>     
<span class='line'>851</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>852</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>853</span>   
<span class='line'>854</span>   </span><span class="COMM">/**
<span class='line'>855</span>     Removes the named style from the style hash.
<span class='line'>856</span>     
<span class='line'>857</span>     Note that if you delete a style, the style will not actually be removed
<span class='line'>858</span>     from the style hash.  Instead, its value will be set to null.
<span class='line'>859</span>     
<span class='line'>860</span>     @param {String} styleName
<span class='line'>861</span>     @returns {SC.RenderContext} receiver
<span class='line'>862</span>   */</span><span class="WHIT">
<span class='line'>863</span>   </span><span class="NAME">removeStyle</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">styleName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>864</span>     </span><span class="COMM">// avoid case where no styles have been defined</span><span class="WHIT">
<span class='line'>865</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._styles</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this._elem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>866</span>     
<span class='line'>867</span>     </span><span class="COMM">// get styles hash.  this will clone if needed.</span><span class="WHIT">
<span class='line'>868</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">styles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.styles</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>869</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">styles</span><span class="PUNC">[</span><span class="NAME">styleName</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>870</span>       </span><span class="NAME">styles</span><span class="PUNC">[</span><span class="NAME">styleName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>871</span>       </span><span class="NAME">this._stylesDidChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>872</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>873</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>874</span>   
<span class='line'>875</span>   </span><span class="COMM">// ..........................................................</span><span class="WHIT">
<span class='line'>876</span>   </span><span class="COMM">// ARBITRARY ATTRIBUTES SUPPORT</span><span class="WHIT">
<span class='line'>877</span>   </span><span class="COMM">// </span><span class="WHIT">
<span class='line'>878</span>   
<span class='line'>879</span>   </span><span class="COMM">/**
<span class='line'>880</span>     Sets the named attribute on the tag.  Note that if you set the 'class'
<span class='line'>881</span>     attribute or the 'styles' attribute, it will be ignored.  Use the 
<span class='line'>882</span>     relevant class name and style methods instead.
<span class='line'>883</span>     
<span class='line'>884</span>     @param {String|Hash} nameOrAttrs the attr name or hash of attrs.
<span class='line'>885</span>     @param {String} value attribute value if attribute name was passed
<span class='line'>886</span>     @returns {SC.RenderContext} receiver
<span class='line'>887</span>   */</span><span class="WHIT">
<span class='line'>888</span>   </span><span class="NAME">attr</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nameOrAttrs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>889</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._attrs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">didChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>890</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._attrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>891</span>     
<span class='line'>892</span>     </span><span class="COMM">// simple form</span><span class="WHIT">
<span class='line'>893</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">nameOrAttrs</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">SC.T_STRING</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>894</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// getter</span><span class="WHIT">
<span class='line'>895</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="NAME">nameOrAttrs</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>896</span>       </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// setter</span><span class="WHIT">
<span class='line'>897</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="NAME">nameOrAttrs</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>898</span>           </span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="NAME">nameOrAttrs</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>899</span>           </span><span class="NAME">this._attrsDidChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>900</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>901</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>902</span>       
<span class='line'>903</span>     </span><span class="COMM">// bulk form</span><span class="WHIT">
<span class='line'>904</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>905</span>       </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">nameOrAttrs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>906</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nameOrAttrs.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>907</span>         </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nameOrAttrs</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>908</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>909</span>           </span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>910</span>           </span><span class="NAME">didChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>911</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>912</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>913</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">didChange</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._attrsDidChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>914</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>915</span>     
<span class='line'>916</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>917</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>918</span> 
<span class='line'>919</span>   </span><span class="COMM">/** @private
<span class='line'>920</span>   */</span><span class="WHIT">
<span class='line'>921</span>   </span><span class="NAME">_camelizeStyleName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>922</span>     </span><span class="COMM">// IE wants the first letter lowercase so we can allow normal behavior</span><span class="WHIT">
<span class='line'>923</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">needsCap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">name.match</span><span class="PUNC">(</span><span class="REGX">/^-(webkit|moz|o)-/</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>924</span>         </span><span class="NAME">camelized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">name.camelize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>925</span> 
<span class='line'>926</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">needsCap</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>927</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">camelized.substr</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">camelized.substr</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>928</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>929</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">camelized</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>930</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>931</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>932</span> 
<span class='line'>933</span>   </span><span class="COMM">/** @private
<span class='line'>934</span>     Converts camelCased style names to dasherized forms
<span class='line'>935</span>   */</span><span class="WHIT">
<span class='line'>936</span>   </span><span class="NAME">_dasherizeStyleName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>937</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dasherized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">name.dasherize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>938</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dasherized.match</span><span class="PUNC">(</span><span class="REGX">/^(webkit|moz|ms|o)-/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">dasherized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">+</span><span class="NAME">dasherized</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>939</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">dasherized</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>940</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>941</span>   
<span class='line'>942</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>943</span> 
<span class='line'>944</span> </span><span class="COMM">/**
<span class='line'>945</span>   html is an alias for push().  Makes thie object more CoreQuery like
<span class='line'>946</span> */</span><span class="WHIT">
<span class='line'>947</span> </span><span class="NAME">SC.RenderContext.fn.html</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.RenderContext.fn.push</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>948</span> 
<span class='line'>949</span> </span><span class="COMM">/**
<span class='line'>950</span>   css is an alias for addStyle().  This this object more CoreQuery like.
<span class='line'>951</span> */</span><span class="WHIT">
<span class='line'>952</span> </span><span class="NAME">SC.RenderContext.fn.css</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.RenderContext.fn.addStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>953</span> 
<span class='line'>954</span> </span><span class="COMM">/** 
<span class='line'>955</span>   Helper method escapes the passed string to ensure HTML is displayed as 
<span class='line'>956</span>   plain text.  You should make sure you pass all user-entered data through
<span class='line'>957</span>   this method to avoid errors.  You can also do this with the text() helper
<span class='line'>958</span>   method on a render context.
<span class='line'>959</span> */</span><span class="WHIT">
<span class='line'>960</span> 
<span class='line'>961</span> 
<span class='line'>962</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">SC.browser.isSafari</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">SC.browser.version</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">526</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>963</span>   </span><span class="NAME">SC.RenderContext._safari3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>964</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>965</span> 
<span class='line'>966</span> </span><span class="NAME">SC.RenderContext.escapeHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>967</span>   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elem</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>968</span>   
<span class='line'>969</span>   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.none</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">text</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// ignore empty</span><span class="WHIT">
<span class='line'>970</span>   
<span class='line'>971</span>   </span><span class="NAME">elem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.escapeHTMLElement</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>972</span>   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">elem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">elem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.escapeHTMLElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'div'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>973</span>   
<span class='line'>974</span>   </span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.escapeTextNode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>975</span>   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">node</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>976</span>     </span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.escapeTextNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createTextNode</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>977</span>     </span><span class="NAME">elem.appendChild</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>978</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>979</span>   
<span class='line'>980</span>   </span><span class="NAME">node.data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">text</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>981</span>   </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elem.innerHTML</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>982</span>   
<span class='line'>983</span>   </span><span class="COMM">// Safari 3 does not escape the '>' character</span><span class="WHIT">
<span class='line'>984</span>   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SC.RenderContext._safari3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ret.replace</span><span class="PUNC">(</span><span class="REGX">/>/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'&gt;'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>985</span> 
<span class='line'>986</span>   </span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>987</span>   </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>988</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>989</span> </span></pre></body></html>